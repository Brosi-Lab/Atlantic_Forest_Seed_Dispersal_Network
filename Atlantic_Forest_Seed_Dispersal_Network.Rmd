---
title: "Consequences of losing endangered frugivores for a tropical seed dispersal network"
author: "Therese Lamperty and Berry Brosi"
date: "started 14 March 2022; most recent edits `r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    number_sections: true
    code_folding: hide
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Overview

In this analysis, our goal was to investigate the roles of endangered frugivores in a diverse tropical forest seed dispersal network and the potential consequences of their loss for the network. 

We used a publicly available data set from Bello et al 2017. It is a collation of multiple studies over 50+ years conducted across the Atlantic Forest biome.

In our analysis, we:

1. Assessed the network degree of endangered frugivores (all frugivores at a greater risk of extinction than those in the 'Least Concern' IUCN category) compared to non-endangered frugivores (those in Least Concern category). We repeat this with frugivores with declining global populations compared to frugivores with increasing global populations.

  1.1 This was repeated at the ecoregion scale in 3 ecoregions (Cerrado, Serra do Mar, and mata caducifolia)
  
2. Simulated frugivore extinctions predicted by endangerment status and used a topolcogical co-extinction model to analyze consequences on network robustness through secondary extinctions. Further, we evaluated if the effects of removing species according to extinction risk differ from removing species in decreasing order of degree and body size, and also a random removal scenario. 

  2.1 This was repeated at the ecoregion scale
  
3. Assessed the degree to which specialist trees rely on endangered frugivores


# Package Loading and Management

## Package loading

```{r create package list, message = F, results = F, warning = F}
# Create package list

Packages <- c("tidyverse", "knitr", "car", "bipartite", "MASS", "ggplot2", "lme4", "boot", "gridExtra", "lattice", "gginnards", "viridis", "viridisLite", "raster", "sp", "rgdal", "cowplot", "AER", "pscl", "degreenet", "DHARMa", "broom.mixed", "grid", "ggpubr")
# Load packages

lapply(Packages, library, character.only = TRUE)

# Clean 

rm(Packages)
```

**Packages used:**


# Data

## Data import


* 1 data set to import (call it "master.df"):
* 'Atlantic frugivory: a plant-frugivore interaction data set for the Atlantic Forest' (Bello et al 2017)
    + https://doi.org/10.1002/ecy.1818
    + a record of 8320 frugivory interactions

* 1 data set not needed to import until later:
* In data-in, there is also a folder veg_1992_ibge - this is the geographical information used to isolate and subset the ecoregions based on the coordinates provided per observation record in the Bello et al data set
    + That data was downloaded from the Brazilian Ministry of the Environment and Instituto Brasileiro de Geografia e Estatistica (IBGE 1993).
    + https://www.ibge.gov.br/en/home-eng.html

```{r data import}
# Load Bello et al 2017 plant-frugivore interaction dataset
master.df <- read.csv("data-in/ATLANTIC_frugivory_full_og.csv")
```


## Data formatting

After initial data formatting and cleaning, there are 6 data frames used in various steps in the analysis: 

* observations (all interactions recorded, includes duplicate interactions)
* binary interaction matrix created from the observations and used in network analysis
* a data set with all metrics (e.g. degree, body mass) for every frugivore species
    + this is called frugivore metadata (I use 'md' for metadata in the code)
* a data set with all metrics (e.g. degree) for every plant species
    + aka plant metadata
* a data set with a record of each unique interaction that occurs in the network with accompanying plant and frugivore degree and frugivore IUCN status
    + aka interaction metadata
    
X 4 because analyses are repeated for the biome and 3 ecoregions

### miscellaneous data formatting

this includes:

* merge genus and species by underscore
* fix trailing spaces and typos in spp names
* add missing body mass data
* create 'lower' and 'higher' risk endangerment category for frugivores
* remove species that are data deficient or not evaluated by IUCN


```{r initial data cleaning and formatting}

# Get rid of spaces in between genus and species for frugivores and plants:

master.df$Frugivore_Species <- sub(" ", "_", master.df$Frugivore_Species)

master.df$Plant_Species <- sub(" ", "_", master.df$Plant_Species)

# Ortalis_guttata has a trailing space, get rid of it:

master.df <- master.df %>%
  mutate(Frugivore_Species = ifelse(Frugivore_Species == "Ortalis_guttata ", "Ortalis_guttata", Frugivore_Species))

# Dataset has some species without body mass data
# Based on web searches for missing body mass values, I could manually add these below:
# conopias trivirgatus flycatcher = approx. 14 g
# dermanura cinerea = 18 g
# Hsunycteris_thomasi = 15 g
# Ortalis_guttata = 400 g
# Salvator_merianae = 2500-4535 g
# Tropidurus_hispidus = 3000g
# Xenohyla_truncata = 8 g
# Xolmis_velatus = 30 g

master.df <- master.df %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Conopias_trivirgatus", "14", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Dermanura_cinerea", "18", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Hsunycteris_thomasi", "15", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Ortalis_guttata", "400", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Salvator_merianae", "3000", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Tropidurus_hispidus", "3000", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Xenohyla_truncata", "8", Frug_Body_Mass)) %>%
  mutate(Frug_Body_Mass = ifelse(Frugivore_Species == "Xolmis_velatus", "30", Frug_Body_Mass))

# If NOT manually adding the missing body mass values by running above code w/mutate, go ahead and remove those frugivores:

# master.df <- master.df %>% filter(!is.na(Frug_Body_Mass))

# Create extra column for broader endangerment grouping: 'lower risk' or 'higher risk' designation. Anything labeled as Least Concern (LC) by IUCN = lower_risk, anything the IUCN labels as vulnerable (VU), Near Threatened (NT), Endangered (EN), or Critically Endangered (CR) = higher_risk

# Remove data deficient and not evaluated species from removal master.df and from matrix

master.df <- master.df %>%
  filter(Frug_IUCN != "DD") %>%
  filter(Frug_IUCN != "NE") %>%
  filter(!is.na(Frug_IUCN))

# Mutate abbreviated IUCN status to create 2 broad categories of higher risk and lower risk

master.df$Frug_risk_level <- master.df$Frug_IUCN # create a copied column of IUCN status to mutate

master.df <- master.df %>%
  mutate(Frug_risk_level = ifelse(Frug_risk_level == "LC", "lower_risk", "higher_risk"))

# Fix inconsistency with population trend capitalization
# Make 'Stable' populations all w/capital S:

master.df <- master.df %>%
  mutate(Frug_Population_Trend = ifelse(Frug_Population_Trend == "stable", "Stable", Frug_Population_Trend))
```

### Create the biome frugivore metadata

Just pulling out info for each species that occurs in the network and coupling it with relevant species info

```{r data formatting continued: create frugivore and plant metadata}
# just want 1 row of data per unique frugivore, and these are the columns I want:

biome_frug_md <- master.df %>%
  distinct(Frugivore_Species, .keep_all = TRUE) %>%
  dplyr::select(Frugivore_Species, Frug_Group, Frug_Body_Mass, Frug_Mean_Gape_Size, Frug_IUCN, Frug_risk_level, Frug_Population_Trend)

# also make body mass numeric

biome_frug_md$Frug_Body_Mass<-as.numeric(biome_frug_md$Frug_Body_Mass)

# plants:

biome_plant_md <- master.df %>%
  distinct(Plant_Species)

# At this point, have 3 things in env that we need: biome_frug_md, biome_plant_md, master.df
```

### Create biome interaction matrix

Make binary (0s and 1s) network from cleaned/formatted observation data frame. Also make interaction metadata to add relevant species info to later. This version of making the interaction matrix is annotated, but the process is repeated identically for each ecoregion, and that code is not annotated to reduce clutter/redundant information.

```{r data formatting continued: create interaction matrix and interaction metatdata for biome}

# create binary interaction matrix

df.EL <- master.df # copy data frame- going to make 'df.EL' into an 'edge list' (EL)

df.EL$intxn <- paste(df.EL$Frugivore_Species, df.EL$Plant_Species, sep = "//") # start making this 'edge list'- pull out pairs of interacting spp

# head(df.EL$intxn) # check it out, should have a column of each interaction name

df.EL <- df.EL %>% # The only info the edge list needs is the species and the interaction existence record
  dplyr::select(Plant_Species, Frugivore_Species, intxn)

# interaction matrix creation function (Beth Morrison), works as weighted or binary:
el.to.imat <- function(edgelist) {
  
  edgelist$intxn = paste(edgelist[ ,1], edgelist[ ,2], sep = "//") # put plants (or lower order species should be in the first column)
  
  edgelist$freq = rep(1, nrow(edgelist))
  
  edgelist.2 = aggregate(edgelist$freq, by = list(edgelist$intxn), FUN = sum)
  
  colnames(edgelist.2) = c('intxn', 'freq')
  
  edgelist.split = do.call(rbind, strsplit(edgelist.2$intxn, "//"))
  
  w.edgelist = data.frame(low.spp = edgelist.split[ ,1], high.spp = edgelist.split[ ,2], freq = edgelist.2$freq)
  
  intxn.mat = spread(w.edgelist, key = "high.spp", value = "freq")
  
  intxn.mat[is.na(intxn.mat)] = 0
  rownames(intxn.mat) = intxn.mat[ ,1]
  intxn.mat = intxn.mat[ ,-1]
  
  return(list(w.edgelist, intxn.mat)) # will return a list; first element is the weighted edge, second element is the matrix
  # sadly, we can't actually use this data as weighted
  
}

el.info <- el.to.imat(df.EL)

i.mat <- el.info[[2]] # store the interaction matrix, it's weighted right now

i.mat[i.mat > 0] <- 1 # change interaction matrix to only 1's and 0's

# head(el.info[[2]]) # make sure it looks ok

biome.mat <- i.mat # copy and rename

# make interaction metadata
biome_interaction_md <- unique(df.EL[c("Frugivore_Species","Plant_Species")])

# Clean
rm(df.EL, el.info, i.mat)

# At this point, we have 5 things in the environment that we need later: biome_interaction_md, biome_frug_md, biome_plant_md, biome.mat, master.df

```

### Compute degree for frugivore and plant species at biome scale

Use `bipartite` specieslevel function to get degree for each species and add to metadata frames

```{r compute species degrees and add to metadata}

# Compute degree for frugivores

Frugivore_degree <- specieslevel(biome.mat, level = "higher", index = "degree")

Frugivore_degree <- Frugivore_degree %>%
  tibble::rownames_to_column("Frugivore_Species") #get it set up to join to metadata

names(Frugivore_degree)[2] <-"Frugivore_degree" #rename

 biome_frug_md<- merge(Frugivore_degree, biome_frug_md, by = "Frugivore_Species") #add degree to frugivore metadata

#------------------------------------------------#

# Compute degree for plants
Plant_degree <- specieslevel(biome.mat, level = "lower", index = "degree")

Plant_degree <- Plant_degree %>%
  tibble::rownames_to_column("Plant_Species") #get it set up to join df

names(Plant_degree)[2] <-"Plant_degree" #rename

biome_plant_md <- merge(biome_plant_md, Plant_degree, by = "Plant_Species") #add degree to plant metadata so I have a record of degree for each plant spp in network

#------------------------------------------------#

# Also add degree for plants and frugivores to the interaction metadata for later

biome_interaction_md <-merge(biome_interaction_md, Plant_degree, by = "Plant_Species")

biome_interaction_md <-merge(biome_interaction_md, Frugivore_degree, by = "Frugivore_Species")

# Next, add the IUCN categoriesand the broader groups of higher risk and lower risk frugivores to the interaction_md

temp <- biome_frug_md %>%
  dplyr::select(Frugivore_Species, Frug_IUCN, Frug_risk_level, Frug_Population_Trend)

biome_interaction_md<-merge(biome_interaction_md, temp, by = "Frugivore_Species")

rm(temp, Plant_degree, Frugivore_degree)

```

### Pull out ecoregions

There are 3 regions covered by Bello et al data set that have a decent number of frugivory observations recorded: Cerrado, Serra do Mar, Mata Caducifolia.

I used shape files of Brazil's vegetation from data available online through Brazil's Ministry of the Environment to determine ecoregion geographical limits and to extract the data from Bello et al that was within each region. 

We decided it is not problematic to use this 1992 vegetation data since the Atlantic forest interaction dataset itself was recorded from the 1960's through 2016 (and the ecoregions shouldn't have changed). 

Within Bello et al's dataset, there are a LOT of studies (maybe 30%) that actually did not have lat/long coordinates for me to reference, but I do have the names of the studies from which all data came from and so I can go and look up where exactly the studies took place to appropriately assign them to a given ecoregion if we decide that's worth it.

```{r match observation coordinates with ecoregion data, message = F, results = F, warning = F}

# not all sites had geographic locations, get rid of those
df.only.with.coords = master.df %>%
  filter(!is.na(Latitude)) %>%
  filter(!is.na(Longitude)) %>%
  mutate(longlat = paste(Longitude, Latitude, sep =","))
# this just eliminated 37.5% of my observations
# now have 5115 obs

# start a new data set, just get unique lat/long coordinates, this is a unique identifier
sites = as.data.frame(levels(as.factor(df.only.with.coords$longlat)))

sites = sites %>%
  rename(longlat = names(sites)) %>%
  mutate(longlat2 = longlat) %>%
  separate(longlat, c("long", "lat"), ",") %>%
  mutate(long = as.numeric(long)) %>%
  mutate(lat = as.numeric(lat))

veg = readOGR("data-in/veg_1992_ibge/brazilveg.shp")

# creating a data frame for the spatial data (point file instead of shape file)

sites2 <- SpatialPointsDataFrame(coords = sites[,c(1,2)], data = sites,
                               proj4string = CRS("+proj=longlat +ellps=GRS67 +towgs84=0,0,0"))

# plot all points and see what vegetation looks like

# plot(sites2)

# plot(veg)

test = over(sites2,veg) # retrieve veg info for each point in sites2

# lines up with forest type column?

test = test %>%
  cbind(sites) %>%
  filter(!is.na(GID)) # gets rid of points in ocean...

data2 = df.only.with.coords %>% filter(longlat %in% test$longlat2) #also gets rid of ocean points in the original data frame

# now my data frame is down to 4308 observations

# levels(as.factor(test$TIPO))
# has all ecoregions I want

# rename w/something more descriptive
ecoregion.info <- test
df.only.with.coords<-data2

# join ecoregion.info and my parred down obs df by longlat (df.only.with.coords) and longlat2 (ecoregion.info) - should end up with a 4308 by 47 df
ecoregion.info$longlat <- ecoregion.info$longlat2
ER.df <- left_join(df.only.with.coords, ecoregion.info, "longlat")

# 13 observations in the Bello et al data have coordinates that seem incorrect - they are for points in the water. Remove those:
ER.df <- ER.df %>% filter(!is.na(TIPO))

# Clean
rm(master.df, sites, sites2, df.only.with.coords, test, data2, veg, ecoregion.info)

# We want to keep ER.df (ecoregion dataframe) in the environment for next few steps
```

### Summarize the extent to which networks per ecoregion have been sampled

How many observations do we have per ecoregion ('TIPO')?

```{r summarize extent to which networks per ecoregion have been sampled}
ER.df %>%
  group_by(TIPO) %>%
  summarise(n())
```

Atividades Agricolas we've decided is a broad category of disturbed/secondary/agricultural areas, and although there is a large number of observations from regions fitting that description, it is not a single ecoregion with biological significance relevant to our study, so we are not going to use that as an 'ecoregion'.
    *For most sampled, these are the top 3, which we will use: Cerrado, Serra do Mar, Mata Caducifolia.

### Isolate the ecoregions with best coverage

To double check, I also looked over what the TIPOS correspond to (Google Earth, image and lit search, etc). 

Floresta Atlantica --> coastal forest (Serra do Mar)
Cerrado --> tropical savanna
Mata Caducifolia --> deciduous tropical forest

```{r subset ecoregions}

# Cerrado

cerrado.df <- ER.df %>%
  filter(TIPO == "Cerrado")

#---------------------------------------------------#

# Serra do Mar

serra.do.mar.df <- ER.df %>%
  filter(TIPO == "Floresta Atlantica")

serra.do.mar.df <- serra.do.mar.df %>%
  mutate(TIPO == ifelse(TIPO == "Floresta Atlantica", "Serra do Mar", TIPO)) # rename the 'Floresta Atlantica' Serra do Mar, which is what this area is broadly called ('coastal forest)

#---------------------------------------------------#

# Mata Caducifolia

mata.caducifolia.df <- ER.df %>%
  filter(TIPO == "Mata Caducifolia")

rm(ER.df)

```

### Create ecoregion frugivore metadata

This is a repeat of what was done above with the biome-scale data. I am sub-setting the data from each ecoregion to get metadata for each frugivore and plant species in a given ecoregion network. 

```{r make frugivore and plant metadata for ecoregions}

# Frugivore metadata creation per ecoregion:

cerrado_frug_md <- cerrado.df %>%
  distinct(Frugivore_Species, .keep_all = TRUE)

serra.do.mar_frug_md <- serra.do.mar.df %>%
  distinct(Frugivore_Species, .keep_all = TRUE)

mata.caducifolia_frug_md <- mata.caducifolia.df %>%
  distinct(Frugivore_Species, .keep_all = TRUE)

#---------------------------------------------------#

# Plant metadata creation per ecoregion:

cerrado_plant_md <- cerrado.df %>%
  distinct(Plant_Species, .keep_all = TRUE)

serra.do.mar_plant_md <- serra.do.mar.df %>%
  distinct(Plant_Species, .keep_all = TRUE)

mata.caducifolia_plant_md <- mata.caducifolia.df %>%
  distinct(Plant_Species, .keep_all = TRUE)

```

### Create ecoregion interaction matrices and interaction metadata

Also a repeat of what was done with the biome-scale data, I am creating binary interaction matrices for each ecoregion. See this process for the biome-scale network above for annotated code. 

```{r make interaction matrices for each ecoregion}

# Cerrado

df.EL <- cerrado.df

df.EL$intxn <- paste(df.EL$Frugivore_Species, df.EL$Plant_Species, sep = "//") 

df.EL <- df.EL %>%
  dplyr::select(Plant_Species, Frugivore_Species, intxn)

el.info <- el.to.imat(df.EL)

i.mat <- el.info[[2]]

i.mat[i.mat > 0] <- 1 

mat.cerrado <- i.mat 

interaction_md.CR <- unique(df.EL[c("Frugivore_Species","Plant_Species")])

#------------------------------------------------#

# Serra do Mar

df.EL <- serra.do.mar.df

df.EL$intxn <- paste(df.EL$Frugivore_Species, df.EL$Plant_Species, sep = "//") 

df.EL <- df.EL %>% 
  dplyr::select(Plant_Species, Frugivore_Species, intxn)

el.info <- el.to.imat(df.EL)

i.mat <- el.info[[2]] 

i.mat[i.mat > 0] <- 1 

mat.serra.do.mar <- i.mat 

interaction_md.SM <- unique(df.EL[c("Frugivore_Species","Plant_Species")])

#------------------------------------------------#

# Mata Caducifolia

df.EL <- mata.caducifolia.df

df.EL$intxn <- paste(df.EL$Frugivore_Species, df.EL$Plant_Species, sep = "//") 

df.EL <- df.EL %>% 
  dplyr::select(Plant_Species, Frugivore_Species, intxn)

el.info <- el.to.imat(df.EL)

i.mat <- el.info[[2]] 

i.mat[i.mat > 0] <- 1 

mat.mata.caducifolia <- i.mat

interaction_md.MC <- unique(df.EL[c("Frugivore_Species","Plant_Species")])

# Clean
rm(i.mat, el.info, el.to.imat, df.EL, mata.caducifolia.df, cerrado.df, serra.do.mar.df)

```

### Compute degree for frugivores and plants and make plant and frugivore metadata at ecoregion scale

As done with biome-scale network above, compute frugivore and plant species' degrees within each ecoregion's network and add to metadata.

```{r compute frugivore and plant network degrees within each ecoregions network}

# Compute frugivore degree for the ecoregions:

# cerrado

Frugivore_degree.CR <- specieslevel(mat.cerrado, level = "higher", index = "degree")

#---------------------------------------------------#

# Serra do Mar

Frugivore_degree.SM <- specieslevel(mat.serra.do.mar, level = "higher", index = "degree")

#---------------------------------------------------#

# Mata caducifolia

Frugivore_degree.MC <- specieslevel(mat.mata.caducifolia, level = "higher", index = "degree")

#----------------------------------------------------------------#

# Add frugivore degree to frugivore metadata:

# cerrado 

Frugivore_degree.CR <- Frugivore_degree.CR %>%
  tibble::rownames_to_column("Frugivore_Species") 

names(Frugivore_degree.CR)[2] <- "Frugivore_degree" 

cerrado_frug_md <- merge(Frugivore_degree.CR, cerrado_frug_md, 
                        by = "Frugivore_Species") 

#---------------------------------------------------#

# Serra do Mar

Frugivore_degree.SM <- Frugivore_degree.SM %>%
  tibble::rownames_to_column("Frugivore_Species") 

names(Frugivore_degree.SM)[2] <-"Frugivore_degree"

serra.do.mar_frug_md <- merge(Frugivore_degree.SM, serra.do.mar_frug_md, 
                              by = "Frugivore_Species") 

#---------------------------------------------------#

# Mata caducifolia

Frugivore_degree.MC <- Frugivore_degree.MC %>%
  tibble::rownames_to_column("Frugivore_Species")

names(Frugivore_degree.MC)[2] <- "Frugivore_degree" 

mata.caducifolia_frug_md <- merge(Frugivore_degree.MC, mata.caducifolia_frug_md, 
                                 by = "Frugivore_Species") 

#-----------------------------------------------------------------#

# Compute plant degree for the ecoregions & add the to plant metadata:

# cerrado

Plant_degree.CR <- specieslevel(mat.cerrado, level = "lower", index = "degree")

Plant_degree.CR <- Plant_degree.CR %>%
  tibble::rownames_to_column("Plant_Species")

names(Plant_degree.CR)[2] <- "Plant_degree"

cerrado_plant_md <- merge(cerrado_plant_md, Plant_degree.CR, 
                          by = "Plant_Species")

#---------------------------------------------------#

# Mata caducifolia

Plant_degree.MC <- specieslevel(mat.mata.caducifolia, level = "lower", 
                                index = "degree")

Plant_degree.MC <- Plant_degree.MC %>%
  tibble::rownames_to_column("Plant_Species") 

names(Plant_degree.MC)[2] <- "Plant_degree"

mata.caducifolia_plant_md <- merge(mata.caducifolia_plant_md, Plant_degree.MC,
                                   by = "Plant_Species") 

#---------------------------------------------------#

# Serra do Mar

Plant_degree.SM <- specieslevel(mat.serra.do.mar, level = "lower", index = "degree")

Plant_degree.SM <- Plant_degree.SM %>%
  tibble::rownames_to_column("Plant_Species") 

names(Plant_degree.SM)[2] <- "Plant_degree" 

serra.do.mar_plant_md <- merge(serra.do.mar_plant_md, Plant_degree.SM, 
                               by = "Plant_Species") 

#-----------------------------------------------------------------#

# Also add degree for plants and frugivores to the dataframe with each unique interaction from the network for later analysis and finish compiling the interaction metadata info by adding the endangerment data for frugivores

# cerrado

interaction_md.CR <- merge(interaction_md.CR, Plant_degree.CR, by = "Plant_Species")

interaction_md.CR <- merge(interaction_md.CR, Frugivore_degree.CR, 
                          by = "Frugivore_Species")

temp <- cerrado_frug_md %>%
  dplyr::select(Frugivore_Species, Frug_risk_level, Frug_IUCN)

interaction_md.CR <- merge(interaction_md.CR, temp, by = "Frugivore_Species")

#---------------------------------------------------#

# Mata Caducifolia

interaction_md.MC <- merge(interaction_md.MC, Plant_degree.MC, by = "Plant_Species")

interaction_md.MC <- merge(interaction_md.MC, Frugivore_degree.MC, 
                          by = "Frugivore_Species")

temp <- mata.caducifolia_frug_md %>%
  dplyr::select(Frugivore_Species, Frug_risk_level, Frug_IUCN)

interaction_md.MC <- merge(interaction_md.MC, temp, by = "Frugivore_Species")

#---------------------------------------------------#

# Serra do Mar

interaction_md.SM <- merge(interaction_md.SM, Plant_degree.SM, by = "Plant_Species")

interaction_md.SM <- merge(interaction_md.SM, Frugivore_degree.SM, 
                          by = "Frugivore_Species")

temp<-serra.do.mar_frug_md %>%
  dplyr::select(Frugivore_Species, Frug_risk_level, Frug_IUCN)

interaction_md.SM <- merge(interaction_md.SM, temp, by = "Frugivore_Species")

#---------------------------------------------------#

# Clean

rm(temp, Frugivore_degree.CR, Frugivore_degree.SM, Frugivore_degree.MC, Plant_degree.CR, Plant_degree.SM, Plant_degree.MC)

```


# Analysis 

* Analysis 1 evaluates relationships between frugivore degree and endangerment status
    + Done first at the biome level, then repeated for each of the ecoregion-scale networks
* Analysis 2 evaluates relationships between frugivore degree and population trend
    + Done first at the biome leve, then repeated for each of the four ecoregions
    + Population trends change before endangerment status does, so it is worthwhile evaluating in addition to just species currently classified as endangered by IUCN
    + Both types of analyses (looking at both IUCN status and population trends as predictors of frugivore network degree) use negative binomial glms
* Analysis 3 uses 'for loops' to simulate different frugivore loss scenarios
    + The scenarios are: decreasing order of IUCN status, body mass, and network degree; plus a random removal scenario
    + This is done for the biome-scale network and for each of the ecoregions
    + Bootstrapping is used to gain estimates and 95% confidence intervals (CI) following the IUCN-status-based and random loss simulations.


## Analysis 1: evaluating relationships between frugivore degree and endangerment status

Negative binomial model evaluating effect of 'higher_risk' versus 'lower_risk' endangerment status of frugivores on their degree: are these two things related?
    + This is only done at the biome scale because the ecoregions have too small of sample sizes
    + Using negative binomial to account for overdispersion
    + To meet model assumptions, we subtract 1 from all degree values so that the count data includes zeros and is able to be modeled with our neg binomial approach
    
### Analysis 1: Data overview - looking at the degree data

#### Biome scale: network degree in lower and higher risk frugivore groups

* Frugivore degree distribution for the biome-scale network:

```{r biome frugivore degree histogram, fig.width = 4, fig.height=4}

hist(biome_frug_md$Frugivore_degree, breaks = 20, main = "Biome\n frugivore degrees", xlab = NULL)

```
There are a lot of singletons and a few frugivores with degree > 50 but it drops off fast.

* Mean degree for frugivores in 'lower risk' category:
```{r biome frugivore mean degree lower risk}

mean(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_risk_level == "lower_risk")])

```
* Mean degree for frugivores in 'higher risk' category:
```{r biome frugivore mean degree higher risk}

mean(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_risk_level == "higher_risk")])

```
* What do the two groups' histograms look like?

```{r histograms for low and high risk frugivore degrees, warning=F}

par(mfrow=c(1,2))

hist(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_risk_level == "lower_risk")], breaks =20, main = "Biome\n frugivore degrees: low risk", xlab = NULL)

hist(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_risk_level == "higher_risk")], breaks = 20, main = "Biome\n frugivore degrees: high risk", xlab = NULL)

```
Definitely a lot more frugivores exist in the 'low risk' category. Lots of singletons in both groups. In high risk, see a bit of a more clumpy distribution and a bump around degree = 50, whereas lower risk category has a smoother tail with greater frequency of frugivores that disperse between 1-30 species. 


#### Ecoregion-scale: network degree in lower and higher risk frugivore groups

* This is all a repeat of what was examined above for the biome-scale, but now at smaller regional-scale networks to check for pattern consistency. 

* First, look at frugivore degree distribution for the ecoregion-scale networks:
```{r ecoregion frugivore degree histogram}

par(mfrow=c(2,2))

hist(cerrado_frug_md$Frugivore_degree, breaks =20, main = "Cerrado\n frugivore degrees", xlab = NULL) 

#cerrado really seems to have frugs with fewer interactions

hist(serra.do.mar_frug_md$Frugivore_degree, breaks =20, main = "Serra do Mar\n frugivore degrees", xlab = NULL)

hist(mata.caducifolia_frug_md$Frugivore_degree, breaks =20, main = "Mata caducifolia\n frugivore degrees", xlab = NULL) #kind of more like cerrado
```
Similar to the biome-scale degree distributions. Noting that the cerrado has a more limited range of frugivore degree values than the other two ecoregions, but it is also the smallest of the 3 regional networks so that likely play a part in that difference.

* What are the mean degrees per risk category per ecoregion?
```{r ecoregion frugivore mean degrees per risk category}

deg.summaries.risklevel <- matrix(nrow = 6, ncol = 3) # make an empty matrix to put mean values in

colnames(deg.summaries.risklevel)<-c('Ecoregion', 'Risk', 'Mean_degree') # label my columns

deg.summaries.risklevel[1:2, 1]<-"Cerrado" # insert region names
deg.summaries.risklevel[3:4, 1]<-"Serra_do_Mar" 
deg.summaries.risklevel[5:6, 1]<-"Mata_caducifolia"

deg.summaries.risklevel[1, 2]<-"lower" # insert category names
deg.summaries.risklevel[2, 2]<-"higher"
deg.summaries.risklevel[3, 2]<-"lower"
deg.summaries.risklevel[4, 2]<-"higher"
deg.summaries.risklevel[5, 2]<-"lower"
deg.summaries.risklevel[6, 2]<-"higher"

# Populate the table:

deg.summaries.risklevel[1, 3] <- mean(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_risk_level == "lower_risk")],) # compute and put the mean for lower risk in the table

deg.summaries.risklevel[2, 3] <- mean(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_risk_level == "higher_risk")]) # compute and put the mean for higher risk in the table

# repeat that for the next two ecoregions:

# serra do mar

deg.summaries.risklevel[3, 3] <- mean(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_risk_level == "lower_risk")],)

deg.summaries.risklevel[4, 3] <- mean(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_risk_level == "higher_risk")],)

# mata caducifolia

deg.summaries.risklevel[5, 3] <- mean(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_risk_level == "lower_risk")],)

deg.summaries.risklevel[6, 3] <- mean(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_risk_level == "higher_risk")],)

deg.summaries.risklevel # show little table

```
Qualitatively, the higher risk frugivores also have higher mean degrees (e.g. they disperse more species of plants, on average, compared to lower risk ones). But it's important to remember here that some of the higher risk categories at the regional scale are pretty small - I think there are only 3 'high risk' frugivores in Cerrado network, for example. 


* As done with the biome-scale data, visually look at and compare histograms for frugivore degrees between the two groups for each ecoregion to get an idea of how data is distributed:

```{r histograms each category aracaria and cerrado}

# clean that table from above chunk real quick

rm(deg.summaries.risklevel)

par(mfrow = c(3,2))

# cerrado, low risk

hist(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_risk_level == "lower_risk")], 
     breaks = 20,  
     main = "Cerrado degrees\n low risk frugs", xlab = NULL)

# cerrado, high risk (all 3 of them..)

hist(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_risk_level == "higher_risk")],
     breaks = 20,
     main = "Cerrado degrees\n high risk frugs", xlab = NULL)

# serra do mar, low risk

hist(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_risk_level == "lower_risk")], 
     breaks = 20, 
     main = "Serra do Mar degrees\n low risk frugs", xlab = NULL)

# serra do mar, high risk

hist(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_risk_level == "higher_risk")], 
     breaks = 20, 
     main = "Serra do Mar degrees\n high risk frugs", xlab = NULL)

# serra do mar, low risk

hist(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_risk_level == "lower_risk")], 
     breaks = 20, 
     main = "Mata caducifolia degrees\n low risk frugs", xlab = NULL)

# serra do mar, high risk

hist(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_risk_level == "higher_risk")], 
     breaks = 20, 
     main = "Mata caducifolia degrees\n high risk frugs", xlab = NULL)

```
Nothing crazy or surprising here; we can see though with cerrado that of those 3 frugivores, one has relatively high degree while other two aren't remarkable (that pulled the mean up for that group obviously). Mata Caducifolia also is kinda split between a few high risk frugivores with relatively high degree for the region, but a larger portion are unremarkable.  


* Number of frugivore species in higher versus lower risk groups: biome-scale
```{r summarise how many species in each endangerment category at biome level}

biome_frug_md %>% group_by(Frug_risk_level) %>%
  summarise(count = length(Frugivore_Species))

```

* Number of frugivore species in higher versus lower risk groups: ecoregion-scale

```{r repeat with ecoregion level, warning=FALSE}

frug.summaries.risklevel <- matrix(nrow = 6, ncol = 3) # make an empty matrix to put mean values in

colnames(frug.summaries.risklevel) <- c('Ecoregion', 'Risk', 'Count') # label my columns

frug.summaries.risklevel[1:2, 1]<-"Cerrado" # insert region names
frug.summaries.risklevel[3:4, 1]<-"Serra_do_Mar" 
frug.summaries.risklevel[5:6, 1]<-"Mata_caducifolia"

frug.summaries.risklevel[1, 2]<-"lower" # insert category names
frug.summaries.risklevel[2, 2]<-"higher"
frug.summaries.risklevel[3, 2]<-"lower"
frug.summaries.risklevel[4, 2]<-"higher"
frug.summaries.risklevel[5, 2]<-"lower"
frug.summaries.risklevel[6, 2]<-"higher"

# populate with data I want 

# cerrado

frug.summaries.risklevel[1, 3] <- length(unique(cerrado_frug_md$Frugivore_Species[
  which(cerrado_frug_md$Frug_risk_level == "higher_risk")]))

frug.summaries.risklevel[2, 3] <-length(unique(cerrado_frug_md$Frugivore_Species[
  which(cerrado_frug_md$Frug_risk_level == "lower_risk")]))

# serra do mar

frug.summaries.risklevel[3, 3] <- length(unique(serra.do.mar_frug_md$Frugivore_Species[
  which(serra.do.mar_frug_md$Frug_risk_level == "higher_risk")]))

frug.summaries.risklevel[4, 3] <-length(unique(serra.do.mar_frug_md$Frugivore_Species[
  which(serra.do.mar_frug_md$Frug_risk_level == "lower_risk")]))

# mata caducifolia

frug.summaries.risklevel[5, 3] <- length(unique(mata.caducifolia_frug_md$Frugivore_Species[
  which(mata.caducifolia_frug_md$Frug_risk_level == "higher_risk")]))

frug.summaries.risklevel[6, 3] <-length(unique(mata.caducifolia_frug_md$Frugivore_Species[
  which(mata.caducifolia_frug_md$Frug_risk_level == "lower_risk")]))

frug.summaries.risklevel

```

    
    
### Analysis 1: Negative binomial model examining relationship between frugivore risk level and degree

```{r analysis 1 component 1}

# our data is 'underdispersed' and fails the negative binomial model assumptions
# to remedy this, we create a separate column for frugivore degree and subtract 1 from all values

biome_frug_md$subzero <- (biome_frug_md$Frugivore_degree) - 1 # transform degree data by subtracting 1 from all values

# negative binomial model

biome.deg.m1 <- glm.nb(subzero ~ Frug_risk_level, data = biome_frug_md)

summary(biome.deg.m1) # look at output

aov.biome.deg.m1 = Anova(biome.deg.m1) # simplify model results

aov.biome.deg.m1 # display simplified results

# save model results

out.aov.biome.deg.m1 = tidy(aov.biome.deg.m1)
# write.csv(out.aov.biome.deg.m1, file = "results/aov.biome.deg.m1-results.csv")

# clean

rm(aov.biome.deg.m1, out.aov.biome.deg.m1)

```

* Summary
    + There is a non-significant trend of frugivores in the 'higher risk' category to have higher network degree values (diet breadths) than frugivores in the IUCN least concern category (Chisq = 1.86, p = 0.17)


### Analysis 1 model validation
```{r model validation analysis 1}

sim.out.biome.deg.m1 <- simulateResiduals(fittedModel = biome.deg.m1, plot = F)

plot(sim.out.biome.deg.m1) # plot residual plots

testDispersion(sim.out.biome.deg.m1, plot = F) # print dispersion results

testZeroInflation(sim.out.biome.deg.m1, plot = F) # print zero-inflation results

# clean

rm(biome.deg.m1, sim.out.biome.deg.m1)

```


The negative binomial model with the transformation of degree - 1 fits model assumptions.

### Analysis 1: figure of frugivore degrees for higher and lower endangerment risk

* This is a boxplot of frugivore network degree at the biome-scale, split into frugivores in the higher risk (NT, VU, EN, CR) and lower risk (LC) IUCN categories
    + the mean values are added as black squares
    + 95% confidence intervals (CIs) are shown as bars around means

```{r analysis 1 get confidence intervals, cache=TRUE}

# Get plot data ready (compute 95% CIs)

# Higher risk = HR, lower risk = LR

# Bootstrap using negative binomial specific function (package degreenet)

# HR

biome_bootstrap.HR <- 
  bootstrapnb(biome_frug_md$Frugivore_degree
              [which(biome_frug_md$Frug_risk_level == "higher_risk")], 
              m = 1000, alpha = 0.95)

# LR

biome_bootstrap.LR <- 
  bootstrapnb(biome_frug_md$Frugivore_degree
              [which(biome_frug_md$Frug_risk_level == "lower_risk")], 
              m = 1000, alpha = 0.95)


# make a dataframe and put the CIs in there for graphing 

biome_bootstrap.temp1 <- data.frame(matrix(vector(),1, 5, dimnames=list(c(), c("Region", "Frug_risk_level", "mean", "lower.95", "upper.95"))))

biome_bootstrap.temp1[1] <- "Atlantic_Forest"

biome_bootstrap.temp1[2] <-"higher_risk"

biome_bootstrap.temp1[3] <- mean(biome_frug_md$Frugivore_degree
                                 [which(biome_frug_md$Frug_risk_level == "higher_risk")])

biome_bootstrap.temp1[4] <- biome_bootstrap.HR[[1]] 

biome_bootstrap.temp1[5] <- biome_bootstrap.HR[[5]]

biome_bootstrap.temp1[2,1] <- "Atlantic_Forest"

biome_bootstrap.temp1[2,2] <-"lower_risk"

biome_bootstrap.temp1[2,3] <- mean(biome_frug_md$Frugivore_degree[
  which(biome_frug_md$Frug_risk_level == "lower_risk")])

biome_bootstrap.temp1[2,4] <- biome_bootstrap.LR[[1]] 

biome_bootstrap.temp1[2,5] <- biome_bootstrap.LR[[5]]

```

```{r make the plot for analysis 1}

biome_deg.risk.level.plot <- biome_frug_md %>%
  
ggplot(aes(x = Frug_risk_level, y = Frugivore_degree, color = Frug_risk_level)) +
  
  geom_point(size = 2, shape = 16, alpha = 0.8,
             position=position_jitterdodge(jitter.width = 0.15)) + # plot each frugivore's degree as jitter/dodged points that are slightly translucent
  
  geom_pointrange(data = biome_bootstrap.temp1, 
                  mapping = aes(x = Frug_risk_level, 
                                y = mean, ymax = upper.95, ymin = lower.95, 
                                color = "black"), size = 0.5, shape = 15) + # add a point to show the means for each risk category and include CIs
  
  theme_bw() + labs(y="No. plant species dispersed", x = NULL) + # theme and add label
  
  theme(axis.text=element_text(colour="black", size = 10)) + # make axis text bigger and black
  
  theme(axis.title = element_text(size = 12, face = "bold")) + #make axis title bigger and bold
  
  scale_x_discrete(labels = c("Higher risk", "Lower risk")) + # add x labels
  
  scale_colour_manual(labels = c("Group mean", "Higher risk", "Lower risk"), 
                      values = c("black","darkred", "#E69F00")) + # specify colors manually
  
  theme(legend.title=element_blank()) + # remove legend
  
  annotate(geom="text", x = 2.2, y = 137, 
           label = bquote(~italic(X^2)~'= 1.30,' ~italic(p)~ '= 0.25')) + # add model output
  
  guides(color=guide_legend(override.aes = list(linetype = c(0,0,0)))) + # restrict what the legend includes
  
  ggtitle("High and low endangerment status") + # add an overall title 
  
  theme(plot.title=element_text(hjust = 0.6)) # adjust where the title shows up

biome_deg.risk.level.plot # display plot

# save plot

# ggsave(biome_deg.risk.level.plot, file = "plots/biome_deg.risk.level.pdf", width = 5, height = 3)

# this plot will be combined with the analysis 2 plot into a panel and that will be saved as a single file

# clean

rm(biome_deg.risk.level.plot, biome_bootstrap.temp, biome_bootstrap.HR, biome_bootstrap.LR, biome_bootstrap.temp1)

```

This plot shows frugivore degree between high and low risk frugivores. Bars show 95% confidence intervals around the mean (which is shown as black point for each group), calculated from 1000 bootstrap iterations.






## Analysis 2

The steps in Analysis 2 are a repeat of Analysis 1 more or less, but here we are looking at frugivores belonging to growing versus shrinking global populations.

### analysis 2 data overview 

#### biome scale: network degree in the increasing population grouper and higher risk frugivore groups

*Mean degree for frugivores in with increasing population sizes (whole biome)
```{r biome mean degree of frugivores with growing pops}
mean(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Increasing")])
```
*And those that have shrinking population sizes
```{r biome mean degree of frugivores with shrinking pops}

mean(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Decreasing")])
```
*What do the two groups' histograms look like? ("pops" = populations)
```{r histograms for decreasing and high risk frugivore degrees}
par(mfrow=c(1,2))
hist(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Increasing")], breaks =20, main = "Biome\n frugivore degrees: inc. pop.", xlab = NULL)
hist(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Decreasing")], breaks = 20, main = "Biome\n frugivore degrees: dec. pop.", xlab = NULL)
```


#### ecoregion-scale: network degree for frugivores of increasing versus decreasing populations sizes

*mean degrees per population trajectory category per ecoregion
```{r ecoregion frugivore mean degrees per risk level}

deg.summaries.population.trend <- matrix(nrow = 8, ncol = 3)
colnames(deg.summaries.population.trend)<-c('Ecoregion', 'Population_Trend', 'Mean_degree')
deg.summaries.population.trend[1:2, 1]<-"Araucaria"
deg.summaries.population.trend[3:4, 1]<-"Cerrado"
deg.summaries.population.trend[5:6, 1]<-"Serra_do_Mar"
deg.summaries.population.trend[7:8, 1]<-"Mata_caducifolia"

deg.summaries.population.trend[1, 2]<-"increasing"
deg.summaries.population.trend[2, 2]<-"decreasing"
deg.summaries.population.trend[3, 2]<-"increasing"
deg.summaries.population.trend[4, 2]<-"decreasing"
deg.summaries.population.trend[5, 2]<-"increasing"
deg.summaries.population.trend[6, 2]<-"decreasing"
deg.summaries.population.trend[7, 2]<-"increasing"
deg.summaries.population.trend[8, 2]<-"decreasing"

deg.summaries.population.trend[1, 3]<-mean(araucaria_frug_md$Frugivore_degree[which(araucaria_frug_md$Frug_Population_Trend == "Increasing")],)
deg.summaries.population.trend[2, 3]<-mean(araucaria_frug_md$Frugivore_degree[which(araucaria_frug_md$Frug_Population_Trend == "Decreasing")])
deg.summaries.population.trend[3, 3]<-mean(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_Population_Trend == "Increasing")],)
deg.summaries.population.trend[4, 3]<-mean(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_Population_Trend == "Decreasing")],)
deg.summaries.population.trend[5, 3]<-mean(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_Population_Trend == "Increasing")],)
deg.summaries.population.trend[6, 3]<-mean(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_Population_Trend == "Decreasing")],)
deg.summaries.population.trend[7, 3]<-mean(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_Population_Trend == "Increasing")])
deg.summaries.population.trend[8, 3]<-mean(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_Population_Trend == "Decreasing")])

deg.summaries.population.trend
```

*Visually look at and compare histograms for frugivore degrees between the two groups for each ecoregion:

```{r histograms of frugivore degrees for araucaria and cerrado}
# clean
rm(deg.summaries.population.trend)

par(mfrow=c(2,2))
hist(araucaria_frug_md$Frugivore_degree[which(araucaria_frug_md$Frug_Population_Trend == "Increasing")], breaks = 20, main = "Araucaria frug degrees\n inc. pop.", xlab = NULL)
hist(araucaria_frug_md$Frugivore_degree[which(araucaria_frug_md$Frug_Population_Trend == "Decreasing")], breaks = 20, main = "Araucaria frug degrees\n dec. pop.", xlab= NULL)

hist(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_Population_Trend == "Increasing")], breaks = 20, main = "Cerrado frug degrees\n inc. pop", xlab=NULL)
hist(cerrado_frug_md$Frugivore_degree[which(cerrado_frug_md$Frug_Population_Trend == "Decreasing")], breaks = 20, main = "Cerrado frug degrees\n dec. pop.", xlab=NULL)
```

```{r histograms of frug degrees serra do mar and mata caducifolia}
par(mfrow=c(2,2))

hist(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_Population_Trend == "Increasing")], breaks = 15, main = "Serra.do.Mar, inc. pop.", xlab=NULL)

hist(serra.do.mar_frug_md$Frugivore_degree[which(serra.do.mar_frug_md$Frug_Population_Trend == "Decreasing")], breaks = 15, main = "Serra.do.Mar, dec. pop.", xlab=NULL)

hist(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_Population_Trend == "Increasing")], breaks = 15, main = "Mata.caducifolia, inc. pop.", xlab=NULL)

hist(mata.caducifolia_frug_md$Frugivore_degree[which(mata.caducifolia_frug_md$Frug_Population_Trend == "Decreasing")], breaks = 15, main = "Mata.caducifolia, dec. pop.", xlab= NULL)

```

*Number of frugivore species in decreasing and increasing population groups: biome-scale
```{r summarise how many species in each population growth trend category at biome level}
biome_frug_md %>% group_by(Frug_Population_Trend) %>%
  summarise(count = length(Frugivore_Species))
```
*Number of frugivore species in decreasing and increasing population groups: ecoregion-scale
```{r summarise again with ecoregion level, warning=FALSE}
keep = c("Araucaria", "Cerrado", "Serra do Mar", "Mata Caducifolia" )
ER.df %>% dplyr::filter(TIPO == keep) %>% 
  group_by(TIPO,Frug_Population_Trend) %>%
  summarise(count = length(Frugivore_Species)) 

# Clean
rm(keep, ER.df)
```



### model, analysis 2
```{r analysis 2 component 1}

# Just interested in increasing and decreasing populations, subset a temporary dataframe with just those groups
biome_frug_popsubset<-biome_frug_md %>%
  dplyr::filter(Frug_Population_Trend == 'Increasing'|Frug_Population_Trend == 'Decreasing')

# Negative binomial model looking at frugivore degree and population trend status

biome.deg.m2 <- glm.nb(subzero ~ Frug_Population_Trend, data = biome_frug_popsubset)
summary(biome.deg.m2)

# Simplify model results
aov.biome.deg.m2 = Anova(biome.deg.m2)

# DISPLAY MODEL RESULTS
aov.biome.deg.m2

# SAVE MODEL RESULTS 
out.aov.biome.deg.m2 = tidy(aov.biome.deg.m2)
# write.csv(out.aov.biome.deg.m2, file = "results/aov.biome.deg.poptrend.m2-results.csv")

# Clean
rm(aov.biome.deg.m2, out.aov.biome.deg.m2)
```

*Summary
    +Frugivores belonging in the decreasing population category disperse a near- significantly greater variety of seeds than those with growing population sizes (Chisq = 3.12, p = 0.077)


### model validation, analysis 2
```{r model validation analysis 2}

sim.out.biome.deg.m2 <- simulateResiduals(fittedModel = biome.deg.m2, plot = F)
plot(sim.out.biome.deg.m2) # plot residual plots
testDispersion(sim.out.biome.deg.m2, plot = F) # print dispersion results
testZeroInflation(sim.out.biome.deg.m2, plot = F) # print zero-inflation results

# Clean
rm(sim.out.biome.deg.m2, biome.deg.m2)
```

When run with the frugivore degree values minus 1 (to allow for zeros in the data), our data meets the negative binomial model assumptions. 


### figure, analysis 2

* This is a boxplot of frugivore network degree at the biome-scale, split into frugivores in the higher risk (NT, VU, EN, CR) and lower risk (LC) IUCN categories
    + the mean values are added as black squares
    + 95% CIs are bars around means

```{r analysis 2 get CIs, cache=TRUE}
# increasing = INC, decreasing = DEC

biome_bootstrap.DEC <- bootstrapnb(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Decreasing")], m = 1000, alpha = 0.95)

biome_bootstrap.INC <- bootstrapnb(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Increasing")], m = 1000, alpha = 0.95)

# temp2 storage dataframe:
biome_bootstrap.temp2 <- data.frame(matrix(vector(),1, 5,
                dimnames=list(c(), c("Region", "Frug_Population_Trend", "mean", "lower.95", "upper.95"))))

biome_bootstrap.temp2[1] <- "Atlantic_Forest"
biome_bootstrap.temp2[2] <-"Decreasing"
biome_bootstrap.temp2[3] <-mean(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Decreasing")])
biome_bootstrap.temp2[4] <- biome_bootstrap.DEC[[1]] 
biome_bootstrap.temp2[5] <- biome_bootstrap.DEC[[5]]
biome_bootstrap.temp2[2,1] <- "Atlantic_Forest"
biome_bootstrap.temp2[2,2] <-"Increasing"
biome_bootstrap.temp2[2,3] <-mean(biome_frug_md$Frugivore_degree[which(biome_frug_md$Frug_Population_Trend == "Increasing")])
biome_bootstrap.temp2[2,4] <- biome_bootstrap.INC[[1]] 
biome_bootstrap.temp2[2,5] <- biome_bootstrap.INC[[5]]
```

```{r make the plot for analysis 2}
# create plot:
biome_deg.pop.trend.plot<-biome_frug_popsubset %>%
ggplot(aes(x = Frug_Population_Trend, y = Frugivore_degree, color = Frug_Population_Trend)) + geom_point(size = 2, shape = 16, alpha = 0.9, position=position_jitterdodge(jitter.width = 0.15)) + 
  geom_pointrange(data = biome_bootstrap.temp2, mapping = aes(x = Frug_Population_Trend, y = mean, ymax = upper.95, ymin = lower.95, color = "black"), size = 0.5, shape = 15)+ theme_bw() + labs(y="No. plant species dispersed", x = NULL) + theme(axis.text=element_text(colour="black", size = 10)) + theme(axis.title = element_text(size = 12, face = "bold"))+ scale_x_discrete(labels = c("Decreasing", "Increasing")) + scale_colour_manual(labels = c("Group mean", "Decreasing", "Increasing"), values = c("black","orange4", "springgreen4")) + theme(legend.title=element_blank()) + annotate(geom="text", x = 2.2, y = 137, label = bquote(~italic(X^2)~'= 3.12,' ~italic(p)~ '= 0.08')) + guides(color=guide_legend(override.aes = list(linetype = c(0,0,0)))) + ggtitle("Decreasing and increasing populations") + theme(plot.title=element_text(hjust = 0.7))

biome_deg.pop.trend.plot

# SAVE PLOT
# ggsave(biome_deg.pop.trend.plot, file = "plots/biome_deg.pop.trend.pdf", width = 5, height = 3)

# Clean
rm(biome_bootstrap.temp, biome_bootstrap.DEC, biome_bootstrap.INC, biome_frug_popsubset, biome_deg.pop.trend.plot, biome_bootstrap.temp2)
```

This plot shows frugivore degree frugivores belonging to populations that are shrinking globally and those that are currently growing. Bars show 95% CIs around the mean (which is shown as black point for each group), calculated from 1000 bootstrap iterations.



## Analysis 3

Simulation of species removals. 
  + This consists of for loops that create:
  + (1) A random removal scenario, then scenarios in which frugivores are removed in decreasing order of (2) endangerment status, (3) degree, and (4) body mass. 
  + Each scenario is run at the biome-scale and then replicated at the ecoregion scale
  + For random removal and within each endangerment status, 1000 iterations are run and then 1000 bootstraps are run to get 95% CIs (and the code for iteration steps takes a long time to run)

### Mean function used in bootstrapping

```{r mean function}
meanfun <- function(data, i){
  d <- data[i, ]
  return(mean(d))   
} #function to take mean - boot package is interesting and you have to write your own function for the 'statistic' argument as far as I can tell
```

### Random removal

Examine co-extinctions of plant species and network robustness under 1000 simulations of randomly losing species

#### Biome-scale random removal simulations and bootstrapping CIs

```{r biome random removals, cache = TRUE}
# run this on 'biome.mat' - the interaction matrix for the full biome
# cache results bc this takes about 30 min to run

biome_robustness_vector_random <- rep(NA, 1000)

biome_plant_survivors_vector_random<- list()

for(j in 1:1000) {
  
  s1.biome.random <- sample(biome_frug_md[ ,'Frugivore_Species'])
  
  triggerlist.biome.random <- list()
  
  for(i in 1:length(s1.biome.random)) {
    triggerlist.biome.random[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s1.biome.random[i])], length(which(biome_frug_md$Frugivore_Species == s1.biome.random[i])))
  }
  
  triggerlist.biome.random <- unlist(triggerlist.biome.random)
  
  triggerlist.biome.random <- as.character(triggerlist.biome.random)
  
  new.mat.biome.random<-list() #making an empty new object
  
  new.mat.biome.random[[1]]<- biome.mat #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist.biome.random)) {
    mat.biome.random <- new.mat.biome.random[[i]]
    mat.biome.random[ ,which(colnames(mat.biome.random) == triggerlist.biome.random[i])]<-0
    new.mat.biome.random[[i+1]] <- mat.biome.random
  }
  
  biome.survivors.ll <-NULL
  biome.survivors.ll[[1]] <- nrow(biome.mat)
  
  for(i in 1:length(new.mat.biome.random)) {biome.survivors.ll[i] <- length(which(rowSums(new.mat.biome.random[[i]])>0))}
  
  biome_plant_survivors_vector_random[[j]]<-biome.survivors.ll
  
  unlist(biome.survivors.ll)
  
  biome.robustness.ll <-(sum(unlist(biome.survivors.ll)))/((ncol(biome.mat))*(nrow(biome.mat)))
  
  biome_robustness_vector_random[j] <- biome.robustness.ll
}

# extract plant survivor counts and get them into a workable form

# copy the time survivors output in case I mess it up, since it is time consuming to make
biome_plant_survivors_vector_random_copy <- biome_plant_survivors_vector_random
# create an empty dataframe and put in my frugivore removal counts
biome_plant_survivors_random_df<-as.data.frame(seq(from = 0, to = 321))
# doesn't behave unless I unlist the survivors vector
# this loop does that and sticks the values into my dataframe with the frugivore removal counts
for(i in 1:length(biome_plant_survivors_vector_random_copy)) {temp_biome_random<-unlist(biome_plant_survivors_vector_random_copy[[i]])
biome_plant_survivors_random_df[,i]<-temp_biome_random}

# I have to transpose it though to get it into a format I can bootstrap etc with easily
# transposing function isn't working unless it is a matrix, so make it a matrix...
biome_plant_survivors_random_mat<-as.matrix(biome_plant_survivors_random_df)
# now transpose that matrix
biome_plant_survivors_random_mat<-t(biome_plant_survivors_random_mat)
# to run my loop below to get the confidence intervals though, I need it back in dataframe format:
biome_plant_survivors_random<-as.data.frame(biome_plant_survivors_random_mat)

# Summary of output pieces:

# 'biome_robustness_vector_random' is a vector of all the robustness values created during each removal over each iteration

# 'biome_plant_survivors_random' has the number of plants surviving at each removal step, for each iteration

# clean

rm(i, j, s1.biome.random, triggerlist.biome.random, new.mat.biome.random, biome.survivors.ll, biome_plant_survivors_vector_random, biome.robustness.ll, biome_plant_survivors_vector_random_copy, biome_plant_survivors_random_df, temp_biome_random, biome_plant_survivors_random_mat) 

```

```{r biome bootstraps ci random removal, cache=TRUE}

biome_random.means.boot<-list() #create empty list to store means

biome_random.upper.cis<-list() #create empty list to store upper CI's

biome_random.lower.cis<-list() #crate empty list to store lower CI's

# loop bootstraps mean and CI's of n lower level survivors for each n frugs removed
# takes ~2.5 hours

# this will not run with the starting value of plants (777) bc every iteration has that same value obviously, and you can't bootstrap data without variation. Same problem with the last values in the removal simulations (the zeros). 

biome_plant_survivors_random<-biome_plant_survivors_random[,-c(1, 322)]

for(i in 1:length(biome_plant_survivors_random)){
  
  means.biome.random <- boot(biome_plant_survivors_random[i], R = 1200, statistic = meanfun) #bootstrap estimate of means for each column
  
  biome.random.mean.int.95.BCa <- boot.ci(means.biome.random, conf = 0.95, type = "bca") #bootstrap's bias corrected confidence intervals
  
  biome_random.lower.cis[[i+1]]<-biome.random.mean.int.95.BCa$bca[1,4] #extract and save lower confidence interval
  biome_random.upper.cis[[i+1]]<-biome.random.mean.int.95.BCa$bca[1,5] #same with upper ci
  biome_random.means.boot[[i+1]] <- means.biome.random$t0 
}


# get it into a workable form
# add column labels, first (0) and last (777) values, combine dataframes

biome_random.means.boot<-as.data.frame(unlist(biome_random.means.boot))
names(biome_random.means.boot)[1]<-"mean"
biome_random.means.boot<-biome_random.means.boot %>% add_row(mean = 0) 
biome_random.means.boot<-biome_random.means.boot %>% add_row(mean = 777,.before = 1)

biome_random.lower.cis<-as.data.frame(unlist(biome_random.lower.cis))

names(biome_random.lower.cis)[1]<-"lower_95.ci"
biome_random.lower.cis<-biome_random.lower.cis %>% add_row(lower_95.ci = 0) 
biome_random.lower.cis<-biome_random.lower.cis %>% add_row(lower_95.ci = 777, .before = 1)

biome_random.upper.cis<-as.data.frame(unlist(biome_random.upper.cis))
names(biome_random.upper.cis)[1]<-"upper_95.ci"
biome_random.upper.cis<-biome_random.upper.cis %>% add_row(upper_95.ci = 0) 
biome_random.upper.cis<-biome_random.upper.cis %>% add_row(upper_95.ci = 777, .before = 1)

biome_plant_survivors_random_btstrped<-cbind(biome_random.means.boot, biome_random.upper.cis, biome_random.lower.cis)

biome_plant_survivors_random_btstrped$n_frugs_removed<-seq(from = 0, to = 321) #for graphing, add column with the number frugivores removed per step to df

# clean

rm(biome_random.means.boot, biome_random.upper.cis, biome_random.lower.cis, biome_plant_survivors_random, means.biome.random, i, biome.random.mean.int.95.BCa) 

```

#### Ecoregion-scale random removal simulations and bootstrapping CIs
##### Araucaria
```{r araucaria random removals, cache = TRUE}
# repeat process from biome on the araucaria ecoregion
araucaria_robustness_vector_random <- rep(NA, 1000)
araucaria_plant_survivors_vector_random<- list()
for(j in 1:1000) {
  
  s1.araucaria.random <- sample(araucaria_frug_md[ ,'Frugivore_Species'])
  
  triggerlist.araucaria.random <- list()
  
  for(i in 1:length(s1.araucaria.random)) {
    triggerlist.araucaria.random[[i]] <- sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frugivore_Species == s1.araucaria.random[i])], length(which(araucaria_frug_md$Frugivore_Species == s1.araucaria.random[i])))
  }
  
  triggerlist.araucaria.random <- unlist(triggerlist.araucaria.random)
  
  triggerlist.araucaria.random <- as.character(triggerlist.araucaria.random)
  
  new.mat.araucaria.random<-list() #making an empty new object
  
  new.mat.araucaria.random[[1]]<-mat.araucaria #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist.araucaria.random)) {
    mat.araucaria.random <- new.mat.araucaria.random[[i]]
    mat.araucaria.random[ ,which(colnames(mat.araucaria.random) == triggerlist.araucaria.random[i])]<-0
    new.mat.araucaria.random[[i+1]] <- mat.araucaria.random
  }
  
  survivors.araucaria.random.ll <-NULL
  survivors.araucaria.random.ll[[1]] <- nrow(mat.araucaria)
  
  for(i in 1:length(new.mat.araucaria.random)) {survivors.araucaria.random.ll[i] <- length(which(rowSums(new.mat.araucaria.random[[i]])>0))}
  
  araucaria_plant_survivors_vector_random[[j]]<-survivors.araucaria.random.ll
  
  unlist(survivors.araucaria.random.ll)
  
  robustness.araucaria.random.ll <-(sum(unlist(survivors.araucaria.random.ll)))/((ncol(mat.araucaria))*(nrow(mat.araucaria)))
  
  araucaria_robustness_vector_random[j] <- robustness.araucaria.random.ll
}
araucaria_plant_survivors_vector_random_copy <- araucaria_plant_survivors_vector_random
araucaria_plant_survivors_random_df<-as.data.frame(seq(from = 0, to = 131))
for(i in 1:length(araucaria_plant_survivors_vector_random_copy)) {temp_araucaria_random<-unlist(araucaria_plant_survivors_vector_random_copy[[i]])
araucaria_plant_survivors_random_df[,i]<-temp_araucaria_random}

araucaria_plant_survivors_random_mat<-as.matrix(araucaria_plant_survivors_random_df)
araucaria_plant_survivors_random_mat<-t(araucaria_plant_survivors_random_mat)
araucaria_plant_survivors_random<-as.data.frame(araucaria_plant_survivors_random_mat)

# Summary of output pieces:
# 'araucaria_robustness_vector_random' is a vector of all the robustness values created during each removal over each iteration
# 'araucaria_plant_survivors_random' is a big dataframe with the number of plants surviving at each removal step, for each iteration (N=1000)

# clean

rm(i, j, s1.araucaria.random, triggerlist.araucaria.random, new.mat.araucaria.random, survivors.araucaria.random.ll, araucaria_plant_survivors_vector_random, robustness.araucaria.random.ll, araucaria_plant_survivors_vector_random_copy, araucaria_plant_survivors_random_df, temp_araucaria_random, araucaria_plant_survivors_random_mat)
```

```{r araucaria bootstraps cis random removal, cache=TRUE}
# same process as above with biome
araucaria_random.means.boot<-list()
araucaria_random.upper.cis<-list() 
araucaria_random.lower.cis<-list()

araucaria_plant_survivors_random<-araucaria_plant_survivors_random[,-c(1,132)]

for(i in 1:length(araucaria_plant_survivors_random)){
  
  means.araucaria.random <- boot(araucaria_plant_survivors_random[i], R = 1200, statistic = meanfun) 
  
  mean.ar.random.int.95.BCa <- boot.ci(means.araucaria.random, conf = 0.95, type = "bca") 
  
  araucaria_random.lower.cis[[i+1]]<-mean.ar.random.int.95.BCa$bca[1,4] 
  araucaria_random.upper.cis[[i+1]]<-mean.ar.random.int.95.BCa$bca[1,5] 
  araucaria_random.means.boot[[i+1]] <- means.araucaria.random$t0  
}

araucaria_random.means.boot<-as.data.frame(unlist(araucaria_random.means.boot))
names(araucaria_random.means.boot)[1]<-"mean"

araucaria_random.means.boot<-araucaria_random.means.boot %>% add_row(mean = 0) 
araucaria_random.means.boot<-araucaria_random.means.boot %>% add_row(mean = 228, .before = 1)

araucaria_random.lower.cis<-as.data.frame(unlist(araucaria_random.lower.cis))
names(araucaria_random.lower.cis)[1]<-"lower_95.ci"

araucaria_random.lower.cis<-araucaria_random.lower.cis %>% add_row(lower_95.ci = 0) 
araucaria_random.lower.cis<-araucaria_random.lower.cis %>% add_row(lower_95.ci = 228, .before = 1) 

araucaria_random.upper.cis<-as.data.frame(unlist(araucaria_random.upper.cis))
names(araucaria_random.upper.cis)[1]<-"upper_95.ci"

araucaria_random.upper.cis<-araucaria_random.upper.cis %>% add_row(upper_95.ci = 0)
araucaria_random.upper.cis<-araucaria_random.upper.cis %>% add_row(upper_95.ci = 228, .before = 1) 

araucaria_plant_survivors_random_btstrped<-cbind(araucaria_random.means.boot, araucaria_random.upper.cis, araucaria_random.lower.cis)
araucaria_plant_survivors_random_btstrped$n_frugs_removed<-seq(from = 0, to = 131)

# clean

rm(araucaria_random.means.boot, araucaria_random.lower.cis, araucaria_random.upper.cis, mean.ar.random.int.95.BCa, means.araucaria.random, i, araucaria_plant_survivors_random)
```

##### Cerrado

```{r cerrado random removals, cache = TRUE}
# run this on 'mat.cerrado' - the interaction matrix for the cerrado ecoregion
cerrado_robustness_vector_random <- rep(NA, 1000)
cerrado_plant_survivors_vector_random<- list()

for(j in 1:1000) {
  
  s1.cerrado.random <- sample(cerrado_frug_md[ ,'Frugivore_Species'])
  
  triggerlist.cerrado.random <- list()
  
  for(i in 1:length(s1.cerrado.random)) {
    triggerlist.cerrado.random[[i]] <- sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frugivore_Species == s1.cerrado.random[i])], length(which(cerrado_frug_md$Frugivore_Species == s1.cerrado.random[i])))
  }
  
  triggerlist.cerrado.random <- unlist(triggerlist.cerrado.random)
  
  triggerlist.cerrado.random <- as.character(triggerlist.cerrado.random)
  
  new.mat.cerrado.random<-list() #making an empty new object
  
  new.mat.cerrado.random[[1]]<-mat.cerrado #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist.cerrado.random)) {
    mat.cerrado.random <- new.mat.cerrado.random[[i]]
    mat.cerrado.random[ ,which(colnames(mat.cerrado.random) == triggerlist.cerrado.random[i])]<-0
    new.mat.cerrado.random[[i+1]] <- mat.cerrado.random
  }
  
  survivors.cerrado.random.ll <-NULL
  survivors.cerrado.random.ll[[1]] <- nrow(mat.cerrado)
  
  for(i in 1:length(new.mat.cerrado.random)) {survivors.cerrado.random.ll[i] <- length(which(rowSums(new.mat.cerrado.random[[i]])>0))}
  
  cerrado_plant_survivors_vector_random[[j]]<-survivors.cerrado.random.ll
  
  unlist(survivors.cerrado.random.ll)
  
  robustness.cerrado.random.ll <-(sum(unlist(survivors.cerrado.random.ll)))/((ncol(mat.cerrado))*(nrow(mat.cerrado)))
  
  cerrado_robustness_vector_random[j] <- robustness.cerrado.random.ll
}

# extract plant survivor counts and get them into a workable form
# copy the time survivors output in case I mess it up, since it is time consuming to make
cerrado_plant_survivors_vector_random_copy <- cerrado_plant_survivors_vector_random
# create an empty dataframe and put in my frugivore removal counts
cerrado_plant_survivors_random_df<-as.data.frame(seq(from = 0, to = 91))
# doesn't behave unless I unlist the survivors vector
# this loop does that and sticks the values into my dataframe with the frugivore removal counts
for(i in 1:length(cerrado_plant_survivors_vector_random_copy)) {temp_cerrado_random<-unlist(cerrado_plant_survivors_vector_random_copy[[i]])
cerrado_plant_survivors_random_df[,i]<-temp_cerrado_random}

# I have to transpose it though to get it into a format I can bootstrap etc with easily
# transposing function isn't working unless it is a matrix, so make it a matrix...
cerrado_plant_survivors_random_mat<-as.matrix(cerrado_plant_survivors_random_df)
# now transpose that matrix
cerrado_plant_survivors_random_mat<-t(cerrado_plant_survivors_random_mat)
# to run my loop below to get the confidence intervals though, I need it back in dataframe format:
cerrado_plant_survivors_random<-as.data.frame(cerrado_plant_survivors_random_mat)

# Summary of output pieces:

# 'cerrado_robustness_vector_random' is a vector of all the robustness values created during each removal over each iteration

# 'cerrado_plant_survivors_random' is a big dataframe with the number of plants surviving at each removal step, for each iteration (N=1000)

# clean:
rm(i, j, s1.cerrado.random, triggerlist.cerrado.random, new.mat.cerrado.random, survivors.cerrado.random.ll, cerrado_plant_survivors_vector_random, robustness.cerrado.random.ll, cerrado_plant_survivors_vector_random_copy, cerrado_plant_survivors_random_df, temp_cerrado_random, cerrado_plant_survivors_random_mat)
```

```{r cerrado bootstrap cis random frug removal, cache=TRUE}

cerrado_random.means.boot<-list() #create empty list to store means
cerrado_random.upper.cis<-list() #create empty list to store upper CI's
cerrado_random.lower.cis<-list() #crate empty list to store lower CI's

# loop bootstraps mean and CI's of n lower level survivors for each n frugs removed
#remove first and last columns bc they have no variation and can't be bootstrapped:

cerrado_plant_survivors_random<-cerrado_plant_survivors_random[,-c(1,92)]

for(i in 1:length(cerrado_plant_survivors_random)){
  
  means.cerrado.random <- boot(cerrado_plant_survivors_random[i], R = 1200, statistic = meanfun) #bootstrap estimate of means for each column
  
  cerrado.random.mean.int.95.BCa <- boot.ci(means.cerrado.random, conf = 0.95, type = "bca") #bootstrap's bias corrected confidence intervals
  
  cerrado_random.lower.cis[[i+1]]<-cerrado.random.mean.int.95.BCa$bca[1,4] #extract and save lower confidence interval
  cerrado_random.upper.cis[[i+1]]<-cerrado.random.mean.int.95.BCa$bca[1,5] #same with upper ci
  cerrado_random.means.boot[[i+1]] <- means.cerrado.random$t0  
}

# get it into a workable form
# add column labels and first (0) and last values, combine dataframes
cerrado_random.means.boot<-as.data.frame(unlist(cerrado_random.means.boot))
names(cerrado_random.means.boot)[1]<-"mean"

cerrado_random.means.boot<-cerrado_random.means.boot %>% add_row(mean = 0) 
cerrado_random.means.boot<-cerrado_random.means.boot %>% add_row(mean = 55, .before = 1)

cerrado_random.lower.cis<-as.data.frame(unlist(cerrado_random.lower.cis))
names(cerrado_random.lower.cis)[1]<-"lower_95.ci"

cerrado_random.lower.cis<-cerrado_random.lower.cis %>% add_row(lower_95.ci = 0) 
cerrado_random.lower.cis<-cerrado_random.lower.cis %>% add_row(lower_95.ci = 55, .before = 1) 

cerrado_random.upper.cis<-as.data.frame(unlist(cerrado_random.upper.cis))
names(cerrado_random.upper.cis)[1]<-"upper_95.ci"

cerrado_random.upper.cis<-cerrado_random.upper.cis %>% add_row(upper_95.ci = 0)
cerrado_random.upper.cis<-cerrado_random.upper.cis %>% add_row(upper_95.ci = 55, .before = 1) 

cerrado_plant_survivors_random_btstrped<-cbind(cerrado_random.means.boot, cerrado_random.upper.cis, cerrado_random.lower.cis)
cerrado_plant_survivors_random_btstrped$n_frugs_removed<-seq(from = 0, to = 91)

# clean

rm(cerrado_random.means.boot, cerrado_random.lower.cis, cerrado_random.upper.cis, cerrado.random.mean.int.95.BCa, cerrado_plant_survivors_random, means.cerrado.random, i)

```

##### Serra do Mar

```{r serra.do.mar random removals, cache = TRUE}
# run this on 'mat.serra.do.mar' - the interaction matrix for the serra.do.mar ecoregion

serra.do.mar_robustness_vector_random <- rep(NA, 1000)

serra.do.mar_plant_survivors_vector_random<- list()

for(j in 1:1000) {
  
  s1.serra.do.mar.random <- sample(serra.do.mar_frug_md[ ,'Frugivore_Species'])
  
  triggerlist.serra.do.mar.random <- list()
  
  for(i in 1:length(s1.serra.do.mar.random)) {
    triggerlist.serra.do.mar.random[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s1.serra.do.mar.random[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s1.serra.do.mar.random[i])))
  }
  
  triggerlist.serra.do.mar.random <- unlist(triggerlist.serra.do.mar.random)
  
  triggerlist.serra.do.mar.random <- as.character(triggerlist.serra.do.mar.random)
  
  new.mat.serra.do.mar.random<-list() #making an empty new object
  
  new.mat.serra.do.mar.random[[1]]<-mat.serra.do.mar #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist.serra.do.mar.random)) {
    mat.serra.do.mar.random <- new.mat.serra.do.mar.random[[i]]
    mat.serra.do.mar.random[ ,which(colnames(mat.serra.do.mar.random) == triggerlist.serra.do.mar.random[i])]<-0
    new.mat.serra.do.mar.random[[i+1]] <- mat.serra.do.mar.random
  }
  
  survivors.serra.do.mar.random.ll <-NULL
  survivors.serra.do.mar.random.ll[[1]] <- nrow(mat.serra.do.mar)
  
  for(i in 1:length(new.mat.serra.do.mar.random)) {survivors.serra.do.mar.random.ll[i] <- length(which(rowSums(new.mat.serra.do.mar.random[[i]])>0))}
  
  serra.do.mar_plant_survivors_vector_random[[j]]<-survivors.serra.do.mar.random.ll
  
  unlist(survivors.serra.do.mar.random.ll)
  
  robustness.serra.do.mar.random.ll <-(sum(unlist(survivors.serra.do.mar.random.ll)))/((ncol(mat.serra.do.mar))*(nrow(mat.serra.do.mar)))
  
  serra.do.mar_robustness_vector_random[j] <- robustness.serra.do.mar.random.ll
}

# extract plant survivor counts and get them into a workable form
# copy the time survivors output in case I mess it up, since it is time consuming to make
serra.do.mar_plant_survivors_vector_random_copy <- serra.do.mar_plant_survivors_vector_random
# create an empty dataframe and put in my frugivore removal counts
serra.do.mar_plant_survivors_random_df<-as.data.frame(seq(from = 0, to = 173))
# doesn't behave unless I unlist the survivors vector
# this loop does that and sticks the values into my dataframe with the frugivore removal counts
for(i in 1:length(serra.do.mar_plant_survivors_vector_random_copy)) {temp_serra.do.mar_random<-unlist(serra.do.mar_plant_survivors_vector_random_copy[[i]])
serra.do.mar_plant_survivors_random_df[,i]<-temp_serra.do.mar_random}

# I have to transpose it though to get it into a format I can bootstrap etc with easily
# transposing function isn't working unless it is a matrix, so make it a matrix...
serra.do.mar_plant_survivors_random_mat<-as.matrix(serra.do.mar_plant_survivors_random_df)
# now transpose that matrix
serra.do.mar_plant_survivors_random_mat<-t(serra.do.mar_plant_survivors_random_mat)
# to run my loop below to get the confidence intervals though, I need it back in dataframe format:
serra.do.mar_plant_survivors_random<-as.data.frame(serra.do.mar_plant_survivors_random_mat)

# Summary of output pieces:

# 'serra.do.mar_robustness_vector_random' is a vector of all the robustness values created during each removal over each iteration

# 'serra.do.mar_plant_survivors_random' is a big dataframe with the number of plants surviving at each removal step, for each iteration (N=1000)

# clean

rm(i, j, s1.serra.do.mar.random, triggerlist.serra.do.mar.random, new.mat.serra.do.mar.random, survivors.serra.do.mar.random.ll, serra.do.mar_plant_survivors_vector_random, robustness.serra.do.mar.random.ll, serra.do.mar_plant_survivors_vector_random_copy, serra.do.mar_plant_survivors_random_df, temp_serra.do.mar_random, serra.do.mar_plant_survivors_random_mat)
```

```{r serra.do.mar bootstraps cis random frug, cache=TRUE}

serra.do.mar_random.means.boot<-list() #create empty list to store means
serra.do.mar_random.upper.cis<-list() #create empty list to store upper CI's
serra.do.mar_random.lower.cis<-list() #crate empty list to store lower CI's

#remove first and last columns bc they have no variation and can't be bootstrapped:
serra.do.mar_plant_survivors_random<-serra.do.mar_plant_survivors_random[,-c(1,174)] # 172 columns; got rid of first and last (0 and 246 vals)

# loop bootstraps mean and CI's of n lower level survivors for each n frugs removed

for(i in 1:length(serra.do.mar_plant_survivors_random)){
  
  means.serra.do.mar.random <- boot(serra.do.mar_plant_survivors_random[i], R = 1200, statistic = meanfun) #bootstrap estimate of means for each column
  
  serra.do.mar.random.mean.int.95.BCa <- boot.ci(means.serra.do.mar.random, conf = 0.95, type = "bca") #bootstrap's bias corrected confidence intervals
  
  serra.do.mar_random.lower.cis[[i+1]]<-serra.do.mar.random.mean.int.95.BCa$bca[1,4] #extract and save lower confidence interval
  serra.do.mar_random.upper.cis[[i+1]]<-serra.do.mar.random.mean.int.95.BCa$bca[1,5] #same with upper ci
  serra.do.mar_random.means.boot[[i+1]] <- means.serra.do.mar.random$t0  
}

# get it into a workable form
# add column labels and first (0) and last values, combine dataframes
serra.do.mar_random.means.boot<-as.data.frame(unlist(serra.do.mar_random.means.boot))
names(serra.do.mar_random.means.boot)[1]<-"mean"

serra.do.mar_random.means.boot<-serra.do.mar_random.means.boot %>% add_row(mean = 0) 
serra.do.mar_random.means.boot<-serra.do.mar_random.means.boot %>% add_row(mean = 246, .before = 1)

serra.do.mar_random.lower.cis<-as.data.frame(unlist(serra.do.mar_random.lower.cis))
names(serra.do.mar_random.lower.cis)[1]<-"lower_95.ci"

serra.do.mar_random.lower.cis<-serra.do.mar_random.lower.cis %>% add_row(lower_95.ci = 0) 
serra.do.mar_random.lower.cis<-serra.do.mar_random.lower.cis %>% add_row(lower_95.ci = 246, .before = 1) 

serra.do.mar_random.upper.cis<-as.data.frame(unlist(serra.do.mar_random.upper.cis))
names(serra.do.mar_random.upper.cis)[1]<-"upper_95.ci"

serra.do.mar_random.upper.cis<-serra.do.mar_random.upper.cis %>% add_row(upper_95.ci = 0)
serra.do.mar_random.upper.cis<-serra.do.mar_random.upper.cis %>% add_row(upper_95.ci = 246, .before = 1) 

serra.do.mar_plant_survivors_random_btstrped <- cbind(serra.do.mar_random.means.boot, serra.do.mar_random.upper.cis, serra.do.mar_random.lower.cis)


serra.do.mar_plant_survivors_random_btstrped$n_frugs_removed<-length(seq(from = 0, to = 173))

# clean

rm(serra.do.mar_random.means.boot, serra.do.mar_random.lower.cis, serra.do.mar_random.upper.cis, serra.do.mar_plant_survivors_random, serra.do.mar.random.mean.int.95.BCa, means.serra.do.mar.random, i)
```

##### Mata Caducifolia

```{r mata.caducifolia random removals, cache = TRUE}
mata.caducifolia_robustness_vector_random <- rep(NA, 1000)
mata.caducifolia_plant_survivors_vector_random<- list()

for(j in 1:1000) {
  
  s1.mata.caducifolia.random <- sample(mata.caducifolia_frug_md[ ,'Frugivore_Species'])
  
  triggerlist.mata.caducifolia.random <- list()
  
  for(i in 1:length(s1.mata.caducifolia.random)) {
    triggerlist.mata.caducifolia.random[[i]] <- sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frugivore_Species == s1.mata.caducifolia.random[i])], length(which(mata.caducifolia_frug_md$Frugivore_Species == s1.mata.caducifolia.random[i])))
  }
  
  triggerlist.mata.caducifolia.random <- unlist(triggerlist.mata.caducifolia.random)
  
  triggerlist.mata.caducifolia.random <- as.character(triggerlist.mata.caducifolia.random)
  
  new.mat<-list() #making an empty new object
  
  new.mat[[1]]<-mat.mata.caducifolia #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist.mata.caducifolia.random)) {
    mat <- new.mat[[i]]
    mat[ ,which(colnames(mat) == triggerlist.mata.caducifolia.random[i])]<-0
    new.mat[[i+1]] <- mat
  }
  
  survivors.mata.caducifolia.random.ll <-NULL
  survivors.mata.caducifolia.random.ll[[1]] <- nrow(mat.mata.caducifolia)
  
  for(i in 1:length(new.mat)) {survivors.mata.caducifolia.random.ll[i] <- length(which(rowSums(new.mat[[i]])>0))}
  
  mata.caducifolia_plant_survivors_vector_random[[j]]<-survivors.mata.caducifolia.random.ll
  
  unlist(survivors.mata.caducifolia.random.ll)
  
  robustness.mata.caducifolia.random.ll <-(sum(unlist(survivors.mata.caducifolia.random.ll)))/((ncol(mat.mata.caducifolia))*(nrow(mat.mata.caducifolia)))
  
  mata.caducifolia_robustness_vector_random[j] <- robustness.mata.caducifolia.random.ll
}

# extract plant survivor counts and get them into a workable form
# copy the time survivors output in case I mess it up, since it is time consuming to make
mata.caducifolia_plant_survivors_vector_random_copy <- mata.caducifolia_plant_survivors_vector_random
# create an empty dataframe and put in my frugivore removal counts
mata.caducifolia_plant_survivors_random_df<-as.data.frame(seq(from = 0, to = 84))
# doesn't behave unless I unlist the survivors vector
# this loop does that and sticks the values into my dataframe with the frugivore removal counts
for(i in 1:length(mata.caducifolia_plant_survivors_vector_random_copy)) {temp_mata.caducifolia_random<-unlist(mata.caducifolia_plant_survivors_vector_random_copy[[i]])
mata.caducifolia_plant_survivors_random_df[,i]<-temp_mata.caducifolia_random}

# I have to transpose it though to get it into a format I can bootstrap etc with easily
# transposing function isn't working unless it is a matrix, so make it a matrix...
mata.caducifolia_plant_survivors_random_mat<-as.matrix(mata.caducifolia_plant_survivors_random_df)
# now transpose that matrix
mata.caducifolia_plant_survivors_random_mat<-t(mata.caducifolia_plant_survivors_random_mat)
# to run my loop below to get the confidence intervals though, I need it back in dataframe format:
mata.caducifolia_plant_survivors_random<-as.data.frame(mata.caducifolia_plant_survivors_random_mat)

# Summary of output pieces:

# 'mata.caducifolia_robustness_vector_random' is a vector of all the robustness values created during each removal over each iteration

# 'mata.caducifolia_plant_survivors_random' is a big dataframe with the number of plants surviving at each removal step, for each iteration (N=1000)

# clean

rm(i, j, s1.mata.caducifolia.random, triggerlist.mata.caducifolia.random, survivors.mata.caducifolia.random.ll, mata.caducifolia_plant_survivors_vector_random, robustness.mata.caducifolia.random.ll, mata.caducifolia_plant_survivors_vector_random_copy, mata.caducifolia_plant_survivors_random_df, temp_mata.caducifolia_random, mata.caducifolia_plant_survivors_random_mat)
```

```{r mata.caducifolia bootstrap cis random removal, cache=TRUE}

mata.caducifolia_random.means.boot<-list() #create empty list to store means

mata.caducifolia_random.upper.cis<-list() #create empty list to store upper CI's

mata.caducifolia_random.lower.cis<-list() #crate empty list to store lower CI's


#remove first and last columns bc they have no variation and can't be bootstrapped:
mata.caducifolia_plant_survivors_random<-mata.caducifolia_plant_survivors_random[,-c(1,85)]

# loop bootstraps mean and CI's of n lower level survivors for each n frugs removed

for(i in 1:length(mata.caducifolia_plant_survivors_random)){
  
  mata.caducifolia.random.means <- boot(mata.caducifolia_plant_survivors_random[i], R = 1200, statistic = meanfun) #bootstrap estimate of means for each column
  
  mata.caducifolia.random.mean.int.95.BCa <- boot.ci(mata.caducifolia.random.means, conf = 0.95, type = "bca") #bootstrap's bias corrected confidence intervals
  
  mata.caducifolia_random.lower.cis[[i+1]]<-mata.caducifolia.random.mean.int.95.BCa$bca[1,4] #extract and save lower confidence interval
  mata.caducifolia_random.upper.cis[[i+1]]<-mata.caducifolia.random.mean.int.95.BCa$bca[1,5] #same with upper ci
  mata.caducifolia_random.means.boot[[i+1]] <- mata.caducifolia.random.means$t0  
}


# get it into a workable form
# add column labels and first (0) and last values, combine dataframes
mata.caducifolia_random.means.boot<-as.data.frame(unlist(mata.caducifolia_random.means.boot))
names(mata.caducifolia_random.means.boot)[1]<-"mean"

mata.caducifolia_random.means.boot<-mata.caducifolia_random.means.boot %>% add_row(mean = 0) 
mata.caducifolia_random.means.boot<-mata.caducifolia_random.means.boot %>% add_row(mean = 129, .before = 1)

mata.caducifolia_random.lower.cis<-as.data.frame(unlist(mata.caducifolia_random.lower.cis))
names(mata.caducifolia_random.lower.cis)[1]<-"lower_95.ci"

mata.caducifolia_random.lower.cis<-mata.caducifolia_random.lower.cis %>% add_row(lower_95.ci = 0) 
mata.caducifolia_random.lower.cis<-mata.caducifolia_random.lower.cis %>% add_row(lower_95.ci = 129, .before = 1) 

mata.caducifolia_random.upper.cis<-as.data.frame(unlist(mata.caducifolia_random.upper.cis))
names(mata.caducifolia_random.upper.cis)[1]<-"upper_95.ci"

mata.caducifolia_random.upper.cis<-mata.caducifolia_random.upper.cis %>% add_row(upper_95.ci = 0)
mata.caducifolia_random.upper.cis<-mata.caducifolia_random.upper.cis %>% add_row(upper_95.ci = 129, .before = 1) 

mata.caducifolia_plant_survivors_random_btstrped<-cbind(mata.caducifolia_random.means.boot, mata.caducifolia_random.upper.cis, mata.caducifolia_random.lower.cis)
mata.caducifolia_plant_survivors_random_btstrped$n_frugs_removed<-seq(from = 0, to = 84)

# clean

rm(mata.caducifolia_random.means.boot, mata.caducifolia_random.lower.cis, mata.caducifolia_random.upper.cis, mata.caducifolia_plant_survivors_random, mata.caducifolia.random.mean.int.95.BCa, mata.caducifolia.random.means, i)

```



### Removal based on most to least endangered

Examine co-extinctions of plant species and network robustness under a frugivore loss scenario during which frugivore species are knocked out in order of most (Critically endangered category) to least (least concern) IUCN categories.
    + multiple species exist within each of the 5 IUCN categories (CR, EN, VU, NT, LC) so this is run 1000 times to get random lots of iterations of randomly removing frugivores within each category in descending order of endangerment status
    
#### Biome-scale endangerment-status-based removal simulations and bootstrapping CIs

```{r biome iucn based removals, cache = TRUE}

rob.vec.IUCN <- rep(NA, 1000)

vec.survivors.IUCN.ll<- list()

for(j in 1:1000) {s1 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "CR")])
triggerlist1 <- list()
  for(i in 1:length(s1)) {
    triggerlist1[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s1[i])], length(which(biome_frug_md$Frugivore_Species == s1[i])))
  }
  triggerlist1 <- unlist(triggerlist1)
  
  triggerlist1 <- as.character(triggerlist1)
  
  #-----------------------------------------#
s2 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "EN")])
triggerlist2 <- list()
  for(i in 1:length(s2)) {
    triggerlist2[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s2[i])], length(which(biome_frug_md$Frugivore_Species == s2[i])))
  }
  triggerlist2 <- unlist(triggerlist2)
  
  triggerlist2 <- as.character(triggerlist2)
    #-----------------------------------------#
  s3 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "VU")])
triggerlist3 <- list()
  for(i in 1:length(s3)) {
    triggerlist3[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s3[i])], length(which(biome_frug_md$Frugivore_Species == s3[i])))
  }
  triggerlist3 <- unlist(triggerlist3)
  
  triggerlist3 <- as.character(triggerlist3)
    #-----------------------------------------#
  s4 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "NT")])
triggerlist4 <- list()
  for(i in 1:length(s4)) {
    triggerlist4[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s4[i])], length(which(biome_frug_md$Frugivore_Species == s4[i])))
  }
  triggerlist4 <- unlist(triggerlist4)
  
  triggerlist4 <- as.character(triggerlist4)
    #-----------------------------------------#
  #s5 should be those that are least concern AND declining in population
  s5 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "LC" & biome_frug_md$Frug_Population_Trend == "Decreasing")])
triggerlist5 <- list()
  for(i in 1:length(s5)) {
    triggerlist5[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s5[i])], length(which(biome_frug_md$Frugivore_Species == s5[i])))
  }
  triggerlist5 <- unlist(triggerlist5)
  
  triggerlist5 <- as.character(triggerlist5)
  #-----------------------------------------#
  #s6 should be those that are LC and have a stable population trend
  s6 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "LC" & biome_frug_md$Frug_Population_Trend == "Stable")])
triggerlist6 <- list()
  for(i in 1:length(s6)) {
    triggerlist6[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s6[i])], length(which(biome_frug_md$Frugivore_Species == s6[i])))
  }
  triggerlist6 <- unlist(triggerlist6)
  
  triggerlist6 <- as.character(triggerlist6)
  #------------------------------------------#
  #s7 should be those that are LC and have an increasing population trend
   s7 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "LC" & biome_frug_md$Frug_Population_Trend == "Increasing")])
triggerlist7 <- list()
  for(i in 1:length(s7)) {
    triggerlist7[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s7[i])], length(which(biome_frug_md$Frugivore_Species == s7[i])))
  }
  triggerlist7 <- unlist(triggerlist7)
  
  triggerlist7 <- as.character(triggerlist7)
  #------------------------------------------#
  #s8 should be those that are LC and have an unknown population trend
   s8 <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frug_IUCN == "LC" & biome_frug_md$Frug_Population_Trend == "Unknown")])
triggerlist8 <- list()
  for(i in 1:length(s8)) {
    triggerlist8[[i]] <- sample(biome_frug_md$Frugivore_Species[which(biome_frug_md$Frugivore_Species == s8[i])], length(which(biome_frug_md$Frugivore_Species == s8[i])))
  }
  triggerlist8 <- unlist(triggerlist8)
  
  triggerlist8 <- as.character(triggerlist8)
  #------------------------------------------#
  #add trigger lists together to make 1 trigger list
  triggerlist <- c(triggerlist1, triggerlist2, triggerlist3, triggerlist4, triggerlist5, triggerlist6, triggerlist7, triggerlist8)
  #-----------------------------------------#
  new.mat<-list() #making an empty new object
  
  new.mat[[1]]<-biome.mat #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist)) {
    mat <- new.mat[[i]]
    mat[ ,which(colnames(mat) == triggerlist[i])]<-0
    new.mat[[i+1]] <- mat
  }
  
  survivors.ll <-NULL
  survivors.ll[[1]] <- nrow(biome.mat)
  
  for(i in 1:length(new.mat)) {survivors.ll[i] <- length(which(rowSums(new.mat[[i]])>0))}
  
  vec.survivors.IUCN.ll[[j]]<-survivors.ll
  
  unlist(survivors.ll)
  
  Robustness.ll <-(sum(unlist(survivors.ll)))/((ncol(biome.mat))*(nrow(biome.mat)))
  
  rob.vec.IUCN[j] <- Robustness.ll
}

#extract survivor values into a workable form

vec.survivors.IUCN.ll_copy <- vec.survivors.IUCN.ll
biome_plant_survivors_IUCN_df<-as.data.frame(seq(from = 0, to = 321))

for(i in 1:length(vec.survivors.IUCN.ll_copy)) {temp_biome_IUCN<-unlist(vec.survivors.IUCN.ll_copy[[i]])
biome_plant_survivors_IUCN_df[,i]<-temp_biome_IUCN}

biome_plant_survivors_IUCN_mat<-as.matrix(biome_plant_survivors_IUCN_df)
biome_plant_survivors_IUCN_mat<-t(biome_plant_survivors_IUCN_mat)
biome_plant_survivors_IUCN<-as.data.frame(biome_plant_survivors_IUCN_mat)

# clean

rm(biome_plant_survivors_IUCN_mat, biome_plant_survivors_IUCN_df, Robustness.ll, survivors.ll, vec.survivors.IUCN.ll, vec.survivors.IUCN.ll_copy, i, j, new.mat, mat, triggerlist, triggerlist1, triggerlist2, triggerlist3, triggerlist4, triggerlist5, triggerlist6, triggerlist7, triggerlist8, rob.vec.IUCN, s1, s2, s3, s4, s5, s6, s7, s8, temp_biome_IUCN)
```

```{r biome iucn based removals bootstrapping, cache = TRUE}
biome_IUCN_means_boot<-list() #create empty list to store means

biome_IUCN_upper_cis<-list() #create empty list to store upper CI's

biome_IUCN_lower_cis<-list() #crate empty list to store lower CI's

biome_plant_survivors_IUCN <- biome_plant_survivors_IUCN[,-c(1, 6, 16, 26, 45, 116, 264, 293, 322)]


for(i in 1:length(biome_plant_survivors_IUCN)){
  
  means <- boot(biome_plant_survivors_IUCN[i], R = 1200, statistic = meanfun)
  
  mean.int.95.BCa <- boot.ci(means, conf = 0.95, type = "bca") 
  
  biome_IUCN_lower_cis[[i+1]]<-mean.int.95.BCa$bca[1,4] 
  biome_IUCN_upper_cis[[i+1]]<-mean.int.95.BCa$bca[1,5] 
  biome_IUCN_means_boot[[i+1]] <- means$t0  
}

biome_IUCN_means_boot<-as.data.frame(unlist(biome_IUCN_means_boot))
names(biome_IUCN_means_boot)[1]<-"mean"

biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 777, .before = 1)
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 730, .before = 6) 
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 628, .before = 16) 
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 598, .before = 26) 
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 574, .before = 45) 
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 499, .before = 116)
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 191, .before = 264)
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 100, .before = 293)
biome_IUCN_means_boot<-biome_IUCN_means_boot %>% add_row(mean = 0) 

biome_IUCN_lower_cis<-as.data.frame(unlist(biome_IUCN_lower_cis))
names(biome_IUCN_lower_cis)[1]<-"lower_95.ci"

biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 777, .before = 1) 
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 730, .before = 6) 
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 628, .before = 16) 
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 598, .before = 26) 
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 574, .before = 45) 
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 499, .before = 116)
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 191, .before = 264)
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 100, .before = 293)
biome_IUCN_lower_cis<-biome_IUCN_lower_cis %>% add_row(lower_95.ci = 0) 

biome_IUCN_upper_cis<-as.data.frame(unlist(biome_IUCN_upper_cis))
names(biome_IUCN_upper_cis)[1]<-"upper_95.ci"

biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 777, .before = 1) 
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 730, .before = 6) 
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 628, .before = 16) 
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 598, .before = 26) 
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 574, .before = 45) 
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 499, .before = 116)
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 191, .before = 264)
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 100, .before = 293)
biome_IUCN_upper_cis<-biome_IUCN_upper_cis %>% add_row(upper_95.ci = 0) 

biome_plant_survivors_IUCN_btstrped<-cbind(biome_IUCN_means_boot, biome_IUCN_upper_cis, biome_IUCN_lower_cis)

biome_plant_survivors_IUCN_btstrped$n_frugs_removed<-seq(from = 0, to = 321)

# clean

rm(means, mean.int.95.BCa, i, biome_IUCN_lower_cis, biome_IUCN_upper_cis, biome_IUCN_means_boot, biome_plant_survivors_IUCN)
```


#### Ecoregion-scale endangerment-status-based removal simulations and boostrapping CIs

##### Araucaria

```{r araucaria iucn based removals, cache=TRUE}
AR_robustness_vec_IUCN <- rep(NA, 1000)

AR_plant_survivors_vec_IUCN<- list()

for(j in 1:1000) {
AR_IUCN_s1 <- c(sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "CR")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "EN")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "VU")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "NT")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "LC" & araucaria_frug_md$Frug_Population_Trend == "Decreasing")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "LC" & araucaria_frug_md$Frug_Population_Trend == "Unknown")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "LC" & araucaria_frug_md$Frug_Population_Trend == "Stable")]), sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frug_IUCN == "LC" & araucaria_frug_md$Frug_Population_Trend == "Increasing")]))

AR.triggerlist.IUCN <- list()
  for(i in 1:length(AR_IUCN_s1)) {
    AR.triggerlist.IUCN[[i]] <- sample(araucaria_frug_md$Frugivore_Species[which(araucaria_frug_md$Frugivore_Species == AR_IUCN_s1[i])], length(which(araucaria_frug_md$Frugivore_Species == AR_IUCN_s1[i])))
  }
  AR.triggerlist.IUCN <- unlist(AR.triggerlist.IUCN)
  
  AR.triggerlist.IUCN <- as.character(AR.triggerlist.IUCN)
  #-----------------------------------------#
  AR.new.mat<-list() #making an empty AR.new object
  
  AR.new.mat[[1]]<-mat.araucaria #specifying the first element will be the original, full matrix
  
  for(i in 1:length(AR.triggerlist.IUCN)) {
    AR.mat <- AR.new.mat[[i]]
    AR.mat[ ,which(colnames(AR.mat) == AR.triggerlist.IUCN[i])]<-0
    AR.new.mat[[i+1]] <- AR.mat
  }
  
  AR.survivors.ll <-NULL
  AR.survivors.ll[[1]] <- nrow(mat.araucaria)
  
  for(i in 1:length(AR.new.mat)) {AR.survivors.ll[i] <- length(which(rowSums(AR.new.mat[[i]])>0))}
  
  AR_plant_survivors_vec_IUCN[[j]]<-AR.survivors.ll
  
  unlist(AR.survivors.ll)
  
  AR.robustness.ll <-(sum(unlist(AR.survivors.ll)))/((ncol(mat.araucaria))*(nrow(mat.araucaria)))
  
  AR_robustness_vec_IUCN[j] <- AR.robustness.ll
}

#extract survivor values into a workable form

AR_plant_survivors_vec_IUCN_copy <- AR_plant_survivors_vec_IUCN
AR_plant_survivors_IUCN_df<-as.data.frame(seq(from = 0, to = 131))
for(i in 1:length(AR_plant_survivors_vec_IUCN_copy)) {temp_AR_IUCN<-unlist(AR_plant_survivors_vec_IUCN_copy[[i]])
AR_plant_survivors_IUCN_df[,i]<-temp_AR_IUCN}

AR_plant_survivors_IUCN_mat<-as.matrix(AR_plant_survivors_IUCN_df)
AR_plant_survivors_IUCN_mat<-t(AR_plant_survivors_IUCN_mat)
AR_plant_survivors_IUCN<-as.data.frame(AR_plant_survivors_IUCN_mat)

# clean

rm(i, j, AR_plant_survivors_vec_IUCN_copy, AR_plant_survivors_IUCN_df, AR_plant_survivors_IUCN_mat, AR.robustness.ll,AR.survivors.ll, AR.new.mat, temp_AR_IUCN, AR.triggerlist.IUCN, AR_IUCN_s1, AR_plant_survivors_vec_IUCN)
```

```{r araucaria iucn based removals bootstrapping, cache=TRUE}

araucaria_IUCN_means_boot<-list() #create empty list to store means

araucaria_IUCN_upper_cis<-list() #create empty list to store upper CI's

araucaria_IUCN_lower_cis<-list() #crate empty list to store lower CI's

# per categorical removal step, there is no variation in final coextinction value bc no matter what ORDER frugivores are removed, in the end, the same frugivores are all absent from the network after a given category is completely extinct (even tho the order in which those frugs go extinct WITHIN that category is randomized per iteration of the simulation). We cannot bootstrap when there is no variation in network coextinction value, so I am pulling out those end point values below and manually adding them back to the resulting bootstrapped dataframe:

AR_plant_survivors_IUCN <- AR_plant_survivors_IUCN[,-c(1, 3, 5, 9, 16, 44, 53, 124, 132)]

for(i in 1:length(AR_plant_survivors_IUCN)){
  
  means <- boot(AR_plant_survivors_IUCN[i], R = 1200, statistic = meanfun) #bootstrap estimate of means for each column
  
  mean.int.95.BCa <- boot.ci(means, conf = 0.95, type = "bca") #bootstrap's bias corrected confidence intervals
  
  araucaria_IUCN_lower_cis[[i+1]]<-mean.int.95.BCa$bca[1,4] #extract and save lower confidence interval
  araucaria_IUCN_upper_cis[[i+1]]<-mean.int.95.BCa$bca[1,5] #same with upper ci
  araucaria_IUCN_means_boot[[i+1]] <- means$t0  
}

# add the non-variation values back in and combine araucaria iucn based removals bootstrapped values
 
araucaria_IUCN_means_boot<-as.data.frame(unlist(araucaria_IUCN_means_boot))
names(araucaria_IUCN_means_boot)[1]<-"mean"

araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 228, .before = 1)
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 227, .before = 3) 
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 224, .before = 5) 
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 216, .before = 9) 
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 209, .before = 16) 
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 187, .before = 44)
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 184, .before = 53)
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 35, .before = 124)
araucaria_IUCN_means_boot<-araucaria_IUCN_means_boot %>% add_row(mean = 0) 

araucaria_IUCN_lower_cis<-as.data.frame(unlist(araucaria_IUCN_lower_cis))
names(araucaria_IUCN_lower_cis)[1]<-"lower_95.ci"

araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 228, .before = 1) 
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 227, .before = 3) 
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 224, .before = 5) 
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 216, .before = 9) 
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 209, .before = 16) 
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 187, .before = 44)
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 184, .before = 53)
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 35, .before = 124)
araucaria_IUCN_lower_cis<-araucaria_IUCN_lower_cis %>% add_row(lower_95.ci = 0) 

araucaria_IUCN_upper_cis<-as.data.frame(unlist(araucaria_IUCN_upper_cis))
names(araucaria_IUCN_upper_cis)[1]<-"upper_95.ci"

araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 228, .before = 1) 
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 227, .before = 3) 
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 224, .before = 5) 
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 216, .before = 9) 
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 209, .before = 16) 
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 187, .before = 44)
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 184, .before = 53)
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 35, .before = 124)
araucaria_IUCN_upper_cis<-araucaria_IUCN_upper_cis %>% add_row(upper_95.ci = 0) 

araucaria_plant_survivors_IUCN_btstrped<-cbind(araucaria_IUCN_means_boot, araucaria_IUCN_upper_cis, araucaria_IUCN_lower_cis)

araucaria_plant_survivors_IUCN_btstrped$n_frugs_removed<-seq(from = 0, to = 131)

# clean

rm(means, mean.int.95.BCa, i, araucaria_IUCN_lower_cis, araucaria_IUCN_upper_cis, araucaria_IUCN_means_boot, AR_plant_survivors_IUCN)
```

##### Cerrado

```{r cerrado iucn based removals, cache=TRUE}
cerrado_robustness_vec_IUCN <- rep(NA, 1000)

cerrado_plant_survivors_vec_IUCN<- list()

for(j in 1:1000) {
cerrado_IUCN_s1 <- c(sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "CR")]), sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "EN")]), sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "VU")]), sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "LC" & cerrado_frug_md$Frug_Population_Trend == "Decreasing")]), sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "LC" & cerrado_frug_md$Frug_Population_Trend == "Unknown")]), sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "LC" & cerrado_frug_md$Frug_Population_Trend == "Stable")]), sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frug_IUCN == "LC" & cerrado_frug_md$Frug_Population_Trend == "Increasing")]))

cerrado_triggerlist.IUCN <- list()
  for(i in 1:length(cerrado_IUCN_s1)) {
    cerrado_triggerlist.IUCN[[i]] <- sample(cerrado_frug_md$Frugivore_Species[which(cerrado_frug_md$Frugivore_Species == cerrado_IUCN_s1[i])], length(which(cerrado_frug_md$Frugivore_Species == cerrado_IUCN_s1[i])))
  }
  cerrado_triggerlist.IUCN <- unlist(cerrado_triggerlist.IUCN)
  
  cerrado_triggerlist.IUCN <- as.character(cerrado_triggerlist.IUCN)
  #-----------------------------------------#
  cerrado_new.mat<-list() #making an empty cerrado_new object
  
  cerrado_new.mat[[1]]<-mat.cerrado #specifying the first element will be the original, full matrix
  
  for(i in 1:length(cerrado_triggerlist.IUCN)) {
    cerrado_mat <- cerrado_new.mat[[i]]
    cerrado_mat[ ,which(colnames(cerrado_mat) == cerrado_triggerlist.IUCN[i])]<-0
    cerrado_new.mat[[i+1]] <- cerrado_mat
  }
  
  cerrado_survivors.ll <-NULL
  cerrado_survivors.ll[[1]] <- nrow(mat.cerrado)
  
  for(i in 1:length(cerrado_new.mat)) {cerrado_survivors.ll[i] <- length(which(rowSums(cerrado_new.mat[[i]])>0))}
  
  cerrado_plant_survivors_vec_IUCN[[j]]<-cerrado_survivors.ll
  
  unlist(cerrado_survivors.ll)
  
  cerrado_robustness.ll <-(sum(unlist(cerrado_survivors.ll)))/((ncol(mat.cerrado))*(nrow(mat.cerrado)))
  
  cerrado_robustness_vec_IUCN[j] <- cerrado_robustness.ll
}

#extract survivor values into a workable form

cerrado_plant_survivors_vec_IUCN_copy <- cerrado_plant_survivors_vec_IUCN
cerrado_plant_survivors_IUCN_df<-as.data.frame(seq(from = 0, to = 91))
for(i in 1:length(cerrado_plant_survivors_vec_IUCN_copy)) {temp_cerrado_IUCN<-unlist(cerrado_plant_survivors_vec_IUCN_copy[[i]])
cerrado_plant_survivors_IUCN_df[,i]<-temp_cerrado_IUCN}

cerrado_plant_survivors_IUCN_mat<-as.matrix(cerrado_plant_survivors_IUCN_df)
cerrado_plant_survivors_IUCN_mat<-t(cerrado_plant_survivors_IUCN_mat)
cerrado_plant_survivors_IUCN<-as.data.frame(cerrado_plant_survivors_IUCN_mat)

# clean

rm(cerrado_plant_survivors_vec_IUCN_copy, cerrado_plant_survivors_IUCN_df, cerrado_plant_survivors_IUCN_mat, cerrado_robustness.ll,cerrado_survivors.ll, cerrado_new.mat, temp_cerrado_IUCN, cerrado_triggerlist.IUCN, cerrado_IUCN_s1, cerrado_plant_survivors_vec_IUCN, i, j)
```

```{r cerrado iucn based removals bootstrapping, cache=TRUE}

cerrado_IUCN_means_boot<-list() #create empty list to store means

cerrado_IUCN_upper_cis<-list() #create empty list to store upper CI's

cerrado_IUCN_lower_cis<-list() #crate empty list to store lower CI's

# per categorical removal step, there is no variation in final coextinction value bc no matter what ORDER frugivores are removed, in the end, the same frugivores are all absent from the network after a given category is completely extinct (even tho the order in which those frugs go extinct WITHIN that category is randomized per iteration of the simulation). We cannot bootstrap when there is no variation in network coextinction value, so I am pulling out those end point values below and manually adding them back to the resulting bootstrapped dataframe:

cerrado_plant_survivors_IUCN <- cerrado_plant_survivors_IUCN[,-c(1, 2, 3, 4, 24, 27, 85, 92)]

for(i in 1:length(cerrado_plant_survivors_IUCN)){
  
  means <- boot(cerrado_plant_survivors_IUCN[i], R = 1200, statistic = meanfun) #bootstrap estimate of means for each column
  
  mean.int.95.BCa <- boot.ci(means, conf = 0.95, type = "bca") #bootstrap's bias corrected confidence intervals
  
  cerrado_IUCN_lower_cis[[i+1]]<-mean.int.95.BCa$bca[1,4] #extract and save lower confidence interval
  cerrado_IUCN_upper_cis[[i+1]]<-mean.int.95.BCa$bca[1,5] #same with upper ci
  cerrado_IUCN_means_boot[[i+1]] <- means$t0  
}

# add the non-variation values back in and combine cerrado iucn based removals bootstrapped values
 
cerrado_IUCN_means_boot<-as.data.frame(unlist(cerrado_IUCN_means_boot))
names(cerrado_IUCN_means_boot)[1]<-"mean"

cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 55, .before = 1)
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 52, .before = 2) 
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 38, .before = 3) 
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 38, .before = 4) 
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 32, .before = 24) 
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 31, .before = 27)
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 6, .before = 85)
cerrado_IUCN_means_boot<-cerrado_IUCN_means_boot %>% add_row(mean = 0) 

cerrado_IUCN_lower_cis<-as.data.frame(unlist(cerrado_IUCN_lower_cis))
names(cerrado_IUCN_lower_cis)[1]<-"lower_95.ci"

cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 55, .before = 1) 
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 52, .before = 2) 
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 38, .before = 3) 
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 38, .before = 4) 
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 32, .before = 24) 
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 31, .before = 27)
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 6, .before = 85)
cerrado_IUCN_lower_cis<-cerrado_IUCN_lower_cis %>% add_row(lower_95.ci = 0) 

cerrado_IUCN_upper_cis<-as.data.frame(unlist(cerrado_IUCN_upper_cis))
names(cerrado_IUCN_upper_cis)[1]<-"upper_95.ci"

cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 55, .before = 1) 
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 52, .before = 2) 
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 38, .before = 3) 
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 38, .before = 4) 
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 32, .before = 24) 
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 31, .before = 27)
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 6, .before = 85)
cerrado_IUCN_upper_cis<-cerrado_IUCN_upper_cis %>% add_row(upper_95.ci = 0) 

cerrado_plant_survivors_IUCN_btstrped<-cbind(cerrado_IUCN_means_boot, cerrado_IUCN_upper_cis, cerrado_IUCN_lower_cis)

cerrado_plant_survivors_IUCN_btstrped$n_frugs_removed<-seq(from = 0, to = 91)

# clean

rm(means, mean.int.95.BCa, i, cerrado_IUCN_lower_cis, cerrado_IUCN_upper_cis, cerrado_IUCN_means_boot, cerrado_plant_survivors_IUCN)
```


##### Serra do Mar

```{r serra.do.mar iucn based removals, cache=TRUE}
#I'm not sure why, but the triggerlists weren't randomizing and so I'm temporarily going back to my older code version of making EIGHT individual triggerlists then combining them after wards - very jenky but appears to fix issue

rob.vec.IUCN <- rep(NA, 1000)

vec.survivors.IUCN.ll<- list()

for(j in 1:1000) {s1 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "CR")])
triggerlist1 <- list()
  for(i in 1:length(s1)) {
    triggerlist1[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s1[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s1[i])))
  }
  triggerlist1 <- unlist(triggerlist1)
  
  triggerlist1 <- as.character(triggerlist1)
  
  #-----------------------------------------#
s2 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "EN")])
triggerlist2 <- list()
  for(i in 1:length(s2)) {
    triggerlist2[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s2[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s2[i])))
  }
  triggerlist2 <- unlist(triggerlist2)
  
  triggerlist2 <- as.character(triggerlist2)
    #-----------------------------------------#
  s3 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "VU")])
triggerlist3 <- list()
  for(i in 1:length(s3)) {
    triggerlist3[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s3[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s3[i])))
  }
  triggerlist3 <- unlist(triggerlist3)
  
  triggerlist3 <- as.character(triggerlist3)
    #-----------------------------------------#
  s4 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "NT")])
triggerlist4 <- list()
  for(i in 1:length(s4)) {
    triggerlist4[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s4[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s4[i])))
  }
  triggerlist4 <- unlist(triggerlist4)
  
  triggerlist4 <- as.character(triggerlist4)
    #-----------------------------------------#
  #s5 should be those that are least concern AND declining in population
  s5 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "LC" & serra.do.mar_frug_md$Frug_Population_Trend == "Decreasing")])
triggerlist5 <- list()
  for(i in 1:length(s5)) {
    triggerlist5[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s5[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s5[i])))
  }
  triggerlist5 <- unlist(triggerlist5)
  
  triggerlist5 <- as.character(triggerlist5)
  #-----------------------------------------#
  #s6 should be those that are LC and have a stable population trend
  s6 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "LC" & serra.do.mar_frug_md$Frug_Population_Trend == "Stable")])
triggerlist6 <- list()
  for(i in 1:length(s6)) {
    triggerlist6[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s6[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s6[i])))
  }
  triggerlist6 <- unlist(triggerlist6)
  
  triggerlist6 <- as.character(triggerlist6)
  #------------------------------------------#
  #s7 should be those that are LC and have an increasing population trend
   s7 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "LC" & serra.do.mar_frug_md$Frug_Population_Trend == "Increasing")])
triggerlist7 <- list()
  for(i in 1:length(s7)) {
    triggerlist7[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s7[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s7[i])))
  }
  triggerlist7 <- unlist(triggerlist7)
  
  triggerlist7 <- as.character(triggerlist7)
  #------------------------------------------#
  #s8 should be those that are LC and have an unknown population trend
   s8 <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frug_IUCN == "LC" & serra.do.mar_frug_md$Frug_Population_Trend == "Unknown")])
triggerlist8 <- list()
  for(i in 1:length(s8)) {
    triggerlist8[[i]] <- sample(serra.do.mar_frug_md$Frugivore_Species[which(serra.do.mar_frug_md$Frugivore_Species == s8[i])], length(which(serra.do.mar_frug_md$Frugivore_Species == s8[i])))
  }
  triggerlist8 <- unlist(triggerlist8)
  
  triggerlist8 <- as.character(triggerlist8)
  #------------------------------------------#
  #add trigger lists together to make 1 trigger list
  triggerlist <- c(triggerlist1, triggerlist2, triggerlist3, triggerlist4, triggerlist5, triggerlist6, triggerlist7, triggerlist8)
  #-----------------------------------------#
  new.mat<-list() #making an empty new object
  
  new.mat[[1]]<-mat.serra.do.mar #specifying the first element will be the original, full matrix
  
  for(i in 1:length(triggerlist)) {
    mat <- new.mat[[i]]
    mat[ ,which(colnames(mat) == triggerlist[i])]<-0
    new.mat[[i+1]] <- mat
  }
  
  survivors.ll <-NULL
  survivors.ll[[1]] <- nrow(mat.serra.do.mar)
  
  for(i in 1:length(new.mat)) {survivors.ll[i] <- length(which(rowSums(new.mat[[i]])>0))}
  
  vec.survivors.IUCN.ll[[j]]<-survivors.ll
  
  unlist(survivors.ll)
  
  Robustness.ll <-(sum(unlist(survivors.ll)))/((ncol(mat.serra.do.mar))*(nrow(mat.serra.do.mar)))
  
  rob.vec.IUCN[j] <- Robustness.ll
}

#extract survivor values into a workable form

vec.survivors.IUCN.ll_copy <- vec.survivors.IUCN.ll
serra.do.mar_plant_survivors_IUCN_df<-as.data.frame(seq(from = 0, to = 173))

for(i in 1:length(vec.survivors.IUCN.ll_copy)) {temp_serra.do.mar_IUCN<-unlist(vec.survivors.IUCN.ll_copy[[i]])
serra.do.mar_plant_survivors_IUCN_df[,i]<-temp_serra.do.mar_IUCN}

serra.do.mar_plant_survivors_IUCN_mat<-as.matrix(serra.do.mar_plant_survivors_IUCN_df)
serra.do.mar_plant_survivors_IUCN_mat<-t(serra.do.mar_plant_survivors_IUCN_mat)
serra.do.mar_plant_survivors_IUCN<-as.data.frame(serra.do.mar_plant_survivors_IUCN_mat)

# clean

rm(serra.do.mar_plant_survivors_IUCN_mat, serra.do.mar_plant_survivors_IUCN_df, Robustness.ll, survivors.ll, vec.survivors.IUCN.ll, vec.survivors.IUCN.ll_copy, i, j, new.mat, mat, triggerlist, triggerlist1, triggerlist2, triggerlist3, triggerlist4, triggerlist5, triggerlist6, triggerlist7, triggerlist8, rob.vec.IUCN, s1, s2, s3, s4, s5, s6, s7, s8)

```

```{r serra.do.mar iucn based removals bootstrapping, cache =TRUE}
serra.do.mar_IUCN_means_boot<-list() #create empty list to store means

serra.do.mar_IUCN_upper_cis<-list() #create empty list to store upper CI's

serra.do.mar_IUCN_lower_cis<-list() #crate empty list to store lower CI's

serra.do.mar_plant_survivors_IUCN <- serra.do.mar_plant_survivors_IUCN[,-c(1, 2, 4, 8, 14, 50, 145, 159, 174)]


for(i in 1:length(serra.do.mar_plant_survivors_IUCN)){
  
  means <- boot(serra.do.mar_plant_survivors_IUCN[i], R = 1200, statistic = meanfun)
  
  mean.int.95.BCa <- boot.ci(means, conf = 0.95, type = "bca") 
  
  serra.do.mar_IUCN_lower_cis[[i+1]]<-mean.int.95.BCa$bca[1,4] 
  serra.do.mar_IUCN_upper_cis[[i+1]]<-mean.int.95.BCa$bca[1,5] 
  serra.do.mar_IUCN_means_boot[[i+1]] <- means$t0  
}


serra.do.mar_IUCN_means_boot<-as.data.frame(unlist(serra.do.mar_IUCN_means_boot))
names(serra.do.mar_IUCN_means_boot)[1]<-"mean"

serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 246, .before = 1)
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 245, .before = 2) 
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 187, .before = 4) 
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 172, .before = 8) 
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 171, .before = 14) 
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 163, .before = 50)
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 56, .before = 145)
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 18, .before = 159)
serra.do.mar_IUCN_means_boot<-serra.do.mar_IUCN_means_boot %>% add_row(mean = 0) 

serra.do.mar_IUCN_lower_cis<-as.data.frame(unlist(serra.do.mar_IUCN_lower_cis))
names(serra.do.mar_IUCN_lower_cis)[1]<-"lower_95.ci"

serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 246, .before = 1) 
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 245, .before = 2) 
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 187, .before = 4) 
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 172, .before = 8) 
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 171, .before = 14) 
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 163, .before = 50)
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 56, .before = 145)
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 18, .before = 159)
serra.do.mar_IUCN_lower_cis<-serra.do.mar_IUCN_lower_cis %>% add_row(lower_95.ci = 0) 

serra.do.mar_IUCN_upper_cis<-as.data.frame(unlist(serra.do.mar_IUCN_upper_cis))
names(serra.do.mar_IUCN_upper_cis)[1]<-"upper_95.ci"

serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 246, .before = 1) 
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 245, .before = 2) 
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 187, .before = 4) 
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 172, .before = 8) 
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 171, .before = 14) 
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 163, .before = 50)
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 56, .before = 145)
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 18, .before = 159)
serra.do.mar_IUCN_upper_cis<-serra.do.mar_IUCN_upper_cis %>% add_row(upper_95.ci = 0) 

serra.do.mar_plant_survivors_IUCN_btstrped<-cbind(serra.do.mar_IUCN_means_boot, serra.do.mar_IUCN_upper_cis, serra.do.mar_IUCN_lower_cis)

serra.do.mar_plant_survivors_IUCN_btstrped$n_frugs_removed<-seq(from = 0, to = 173)

# clean

rm(means, mean.int.95.BCa, i, serra.do.mar_IUCN_lower_cis, serra.do.mar_IUCN_upper_cis, serra.do.mar_IUCN_means_boot, serra.do.mar_plant_survivors_IUCN, temp_serra.do.mar_IUCN)
```

##### Mata Caducifolia

```{r mata caducifolia IUCN based removals, cache = TRUE}

mata.caducifolia_robustness_vec_IUCN <- rep(NA, 1000)

mata.caducifolia_plant_survivors_vec_IUCN<- list()

for(j in 1:1000) {
mata.caducifolia_IUCN_s1 <- c(sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "CR")]),
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "EN")]), 
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "VU")]), 
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "NT")]), 
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "LC" & mata.caducifolia_frug_md$Frug_Population_Trend == "Decreasing")]),
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "LC" & mata.caducifolia_frug_md$Frug_Population_Trend == "Unknown")]),
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "LC" & mata.caducifolia_frug_md$Frug_Population_Trend == "Stable")]),
                              sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frug_IUCN == "LC" & mata.caducifolia_frug_md$Frug_Population_Trend == "Increasing")]))

mata.caducifolia.triggerlist.IUCN <- list()

  for(i in 1:length(mata.caducifolia_IUCN_s1)) {
    mata.caducifolia.triggerlist.IUCN[[i]] <- sample(mata.caducifolia_frug_md$Frugivore_Species[which(mata.caducifolia_frug_md$Frugivore_Species == mata.caducifolia_IUCN_s1[i])], length(which(mata.caducifolia_frug_md$Frugivore_Species == mata.caducifolia_IUCN_s1[i])))
  }

  mata.caducifolia.triggerlist.IUCN <- unlist(mata.caducifolia.triggerlist.IUCN)
  
  mata.caducifolia.triggerlist.IUCN <- as.character(mata.caducifolia.triggerlist.IUCN)
  
  #-----------------------------------------#
  
  mata.caducifolia.new.mat<-list()
  
  mata.caducifolia.new.mat[[1]]<-mat.mata.caducifolia
  
  for(i in 1:length(mata.caducifolia.triggerlist.IUCN)) {
    mata.caducifolia.mat <- mata.caducifolia.new.mat[[i]]
    mata.caducifolia.mat[ ,which(colnames(mata.caducifolia.mat) == mata.caducifolia.triggerlist.IUCN[i])]<-0
    mata.caducifolia.new.mat[[i+1]] <- mata.caducifolia.mat
  }
  
  mata.caducifolia.survivors.ll <-NULL
  
  mata.caducifolia.survivors.ll[[1]] <- nrow(mat.mata.caducifolia)
  
  for(i in 1:length(mata.caducifolia.new.mat)) {mata.caducifolia.survivors.ll[i] <- length(which(rowSums(mata.caducifolia.new.mat[[i]])>0))}
  
  mata.caducifolia_plant_survivors_vec_IUCN[[j]]<-mata.caducifolia.survivors.ll
  
  unlist(mata.caducifolia.survivors.ll)
  
  mata.caducifolia.robustness.ll <-(sum(unlist(mata.caducifolia.survivors.ll)))/((ncol(mat.mata.caducifolia))*(nrow(mat.mata.caducifolia)))
  
  mata.caducifolia_robustness_vec_IUCN[j] <- mata.caducifolia.robustness.ll
}

#extract survivor values into a workable form

mata.caducifolia_plant_survivors_vec_IUCN_copy <- mata.caducifolia_plant_survivors_vec_IUCN
mata.caducifolia_plant_survivors_IUCN_df<-as.data.frame(seq(from = 0, to = 84))
for(i in 1:length(mata.caducifolia_plant_survivors_vec_IUCN_copy)) {temp_mata.caducifolia_IUCN<-unlist(mata.caducifolia_plant_survivors_vec_IUCN_copy[[i]])
mata.caducifolia_plant_survivors_IUCN_df[,i]<-temp_mata.caducifolia_IUCN}

mata.caducifolia_plant_survivors_IUCN_mat<-as.matrix(mata.caducifolia_plant_survivors_IUCN_df)
mata.caducifolia_plant_survivors_IUCN_mat<-t(mata.caducifolia_plant_survivors_IUCN_mat)
mata.caducifolia_plant_survivors_IUCN<-as.data.frame(mata.caducifolia_plant_survivors_IUCN_mat)

# clean

rm(mata.caducifolia_plant_survivors_vec_IUCN_copy, mata.caducifolia_plant_survivors_IUCN_df, mata.caducifolia_plant_survivors_IUCN_mat, mata.caducifolia.robustness.ll,mata.caducifolia.survivors.ll, mata.caducifolia.new.mat, temp_mata.caducifolia_IUCN, mata.caducifolia.triggerlist.IUCN, mata.caducifolia_IUCN_s1, mata.caducifolia_plant_survivors_vec_IUCN, i, j)

```

```{r mata caducifolia iucn based removals bootstrapping, cache=TRUE}
mata.caducifolia_IUCN_means_boot<-list() #create empty list to store means

mata.caducifolia_IUCN_upper_cis<-list() #create empty list to store upper CI's

mata.caducifolia_IUCN_lower_cis<-list() #crate empty list to store lower CI's

mata.caducifolia_plant_survivors_IUCN <- mata.caducifolia_plant_survivors_IUCN[,-c(1, 2, 4, 5, 6, 22, 24, 77, 85)]


for(i in 1:length(mata.caducifolia_plant_survivors_IUCN)){
  
  means <- boot(mata.caducifolia_plant_survivors_IUCN[i], R = 1200, statistic = meanfun)
  
  mean.int.95.BCa <- boot.ci(means, conf = 0.95, type = "bca") 
  
  mata.caducifolia_IUCN_lower_cis[[i+1]]<-mean.int.95.BCa$bca[1,4] 
  mata.caducifolia_IUCN_upper_cis[[i+1]]<-mean.int.95.BCa$bca[1,5] 
  mata.caducifolia_IUCN_means_boot[[i+1]] <- means$t0  
}

mata.caducifolia_IUCN_means_boot<-as.data.frame(unlist(mata.caducifolia_IUCN_means_boot))
names(mata.caducifolia_IUCN_means_boot)[1]<-"mean"

mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 129, .before = 1)
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 114, .before = 2) 
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 110, .before = 4) 
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 109, .before = 5) 
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 109, .before = 6) 
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 107, .before = 22)
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 101, .before = 24)
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 17, .before = 77)
mata.caducifolia_IUCN_means_boot<-mata.caducifolia_IUCN_means_boot %>% add_row(mean = 0) 

mata.caducifolia_IUCN_lower_cis<-as.data.frame(unlist(mata.caducifolia_IUCN_lower_cis))
names(mata.caducifolia_IUCN_lower_cis)[1]<-"lower_95.ci"

mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 129, .before = 1) 
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 114, .before = 2) 
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 110, .before = 4) 
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 109, .before = 5) 
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 109, .before = 6) 
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 107, .before = 22)
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 101, .before = 24)
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 17, .before = 77)
mata.caducifolia_IUCN_lower_cis<-mata.caducifolia_IUCN_lower_cis %>% add_row(lower_95.ci = 0) 

mata.caducifolia_IUCN_upper_cis<-as.data.frame(unlist(mata.caducifolia_IUCN_upper_cis))
names(mata.caducifolia_IUCN_upper_cis)[1]<-"upper_95.ci"

mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 129, .before = 1) 
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 114, .before = 2) 
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 110, .before = 4) 
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 109, .before = 5) 
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 109, .before = 6) 
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 107, .before = 22)
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 101, .before = 24)
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 17, .before = 77)
mata.caducifolia_IUCN_upper_cis<-mata.caducifolia_IUCN_upper_cis %>% add_row(upper_95.ci = 0) 

mata.caducifolia_plant_survivors_IUCN_btstrped<-cbind(mata.caducifolia_IUCN_means_boot, mata.caducifolia_IUCN_upper_cis, mata.caducifolia_IUCN_lower_cis)

mata.caducifolia_plant_survivors_IUCN_btstrped$n_frugs_removed<-seq(from = 0, to = 84)

# clean

rm(means, mean.int.95.BCa, i, mata.caducifolia_IUCN_lower_cis, mata.caducifolia_IUCN_upper_cis, mata.caducifolia_IUCN_means_boot, mata.caducifolia_plant_survivors_IUCN)

```
    
    
### Removal based on greatest to lowest body mass

#### Biome-scale body-mass-based removal simulations

```{r biome-scale removal scenario of frugivores by descending body mass}
    biome_bodymass_triggerlist <- biome_frug_md %>% dplyr::arrange(desc(Frug_Body_Mass)) %>% dplyr::select(Frugivore_Species)
biome_bodymass_triggerlist <- unlist(biome_bodymass_triggerlist)
  #-----------------------------------------#
  biome_new.mat_bodymass<-list()
  biome_new.mat_bodymass[[1]]<-biome.mat
  for(i in 1:length(biome_bodymass_triggerlist)) {
    biome.mat.temp <- biome_new.mat_bodymass[[i]]
    biome.mat.temp[ ,which(colnames(biome.mat.temp) == biome_bodymass_triggerlist[i])]<-0
    biome_new.mat_bodymass[[i+1]] <- biome.mat.temp
  }
  biome_plant_survivors_bodymass <-NULL
  biome_plant_survivors_bodymass[[1]] <- nrow(biome.mat)
  for(i in 1:length(biome_new.mat_bodymass)) {biome_plant_survivors_bodymass[i] <- length(which(rowSums(biome_new.mat_bodymass[[i]])>0))} 
  
biome_robustness_bodymass <-(sum(unlist(biome_plant_survivors_bodymass)))/((ncol(biome.mat))*(nrow(biome.mat)))

# get output ready to join with others for graphing

biome_plant_survivors_bodymass <- as.data.frame(unlist(biome_plant_survivors_bodymass))

# make a frugivores removed column

biome_plant_survivors_bodymass$n_frugs_removed <- seq(from = 0, to = 321)

# rename survivor column

names(biome_plant_survivors_bodymass)[1]<-"n_plants_remaining"

# add removal scenario column
biome_plant_survivors_bodymass$scenario<-"descending_bodymass"

# clean

rm(i, biome_new.mat_bodymass, biome.mat.temp, biome_bodymass_triggerlist)

```

#### Ecoregion-scale body-mass-based removal simulations

```{r araucaria body-mass-based removal simulation}
    araucaria_bodymass_triggerlist <- araucaria_frug_md %>% dplyr::arrange(desc(Frug_Body_Mass)) %>% dplyr::select(Frugivore_Species)
araucaria_bodymass_triggerlist <- unlist(araucaria_bodymass_triggerlist)
  #-----------------------------------------#
  araucaria_new.mat_bodymass<-list()
  araucaria_new.mat_bodymass[[1]]<-mat.araucaria
  for(i in 1:length(araucaria_bodymass_triggerlist)) {
    mat.araucaria.temp <- araucaria_new.mat_bodymass[[i]]
    mat.araucaria.temp[ ,which(colnames(mat.araucaria.temp) == araucaria_bodymass_triggerlist[i])]<-0
    araucaria_new.mat_bodymass[[i+1]] <- mat.araucaria.temp
  }
  araucaria_plant_survivors_bodymass <-NULL
  araucaria_plant_survivors_bodymass[[1]] <- nrow(mat.araucaria)
  for(i in 1:length(araucaria_new.mat_bodymass)) {araucaria_plant_survivors_bodymass[i] <- length(which(rowSums(araucaria_new.mat_bodymass[[i]])>0))} 
  
araucaria_robustness_bodymass <-(sum(unlist(araucaria_plant_survivors_bodymass)))/((ncol(mat.araucaria))*(nrow(mat.araucaria)))

# get output ready to join with others for graphing

araucaria_plant_survivors_bodymass <- as.data.frame(unlist(araucaria_plant_survivors_bodymass))

# make a frugivores removed column

araucaria_plant_survivors_bodymass$n_frugs_removed <- seq(from = 0, to = 131)

# rename survivor column

names(araucaria_plant_survivors_bodymass)[1]<-"n_plants_remaining"

# add removal scenario column
araucaria_plant_survivors_bodymass$scenario<-"descending_bodymass"

# clean

rm(i, araucaria_new.mat_bodymass, mat.araucaria.temp, araucaria_bodymass_triggerlist)
```

```{r cerrado body-mass-based removal simulation}
 cerrado_bodymass_triggerlist <- cerrado_frug_md %>% dplyr::arrange(desc(Frug_Body_Mass)) %>% dplyr::select(Frugivore_Species)
cerrado_bodymass_triggerlist <- unlist(cerrado_bodymass_triggerlist)
  #-----------------------------------------#
  cerrado_new.mat_bodymass<-list()
  cerrado_new.mat_bodymass[[1]]<-mat.cerrado
  for(i in 1:length(cerrado_bodymass_triggerlist)) {
    mat.cerrado.temp <- cerrado_new.mat_bodymass[[i]]
    mat.cerrado.temp[ ,which(colnames(mat.cerrado.temp) == cerrado_bodymass_triggerlist[i])]<-0
    cerrado_new.mat_bodymass[[i+1]] <- mat.cerrado.temp
  }
  cerrado_plant_survivors_bodymass <-NULL
  cerrado_plant_survivors_bodymass[[1]] <- nrow(mat.cerrado)
  for(i in 1:length(cerrado_new.mat_bodymass)) {cerrado_plant_survivors_bodymass[i] <- length(which(rowSums(cerrado_new.mat_bodymass[[i]])>0))} 
  
cerrado_robustness_bodymass <-(sum(unlist(cerrado_plant_survivors_bodymass)))/((ncol(mat.cerrado))*(nrow(mat.cerrado)))

# get output ready to join with others for graphing

cerrado_plant_survivors_bodymass <- as.data.frame(unlist(cerrado_plant_survivors_bodymass))

# make a frugivores removed column

cerrado_plant_survivors_bodymass$n_frugs_removed <- seq(from = 0, to = 91)

# rename survivor column

names(cerrado_plant_survivors_bodymass)[1]<-"n_plants_remaining"

# add removal scenario column
cerrado_plant_survivors_bodymass$scenario<-"descending_bodymass"

# clean

rm(i, cerrado_new.mat_bodymass, mat.cerrado.temp, cerrado_bodymass_triggerlist)
```

```{r serra do mar body-mass-based removal simulation}
 serra.do.mar_bodymass_triggerlist <- serra.do.mar_frug_md %>% dplyr::arrange(desc(Frug_Body_Mass)) %>% dplyr::select(Frugivore_Species)
serra.do.mar_bodymass_triggerlist <- unlist(serra.do.mar_bodymass_triggerlist)
  #-----------------------------------------#
  serra.do.mar_new.mat_bodymass<-list()
  serra.do.mar_new.mat_bodymass[[1]]<-mat.serra.do.mar
  for(i in 1:length(serra.do.mar_bodymass_triggerlist)) {
    mat.serra.do.mar.temp <- serra.do.mar_new.mat_bodymass[[i]]
    mat.serra.do.mar.temp[ ,which(colnames(mat.serra.do.mar.temp) == serra.do.mar_bodymass_triggerlist[i])]<-0
    serra.do.mar_new.mat_bodymass[[i+1]] <- mat.serra.do.mar.temp
  }
  serra.do.mar_plant_survivors_bodymass <-NULL
  serra.do.mar_plant_survivors_bodymass[[1]] <- nrow(mat.serra.do.mar)
  for(i in 1:length(serra.do.mar_new.mat_bodymass)) {serra.do.mar_plant_survivors_bodymass[i] <- length(which(rowSums(serra.do.mar_new.mat_bodymass[[i]])>0))} 
  
serra.do.mar_robustness_bodymass <-(sum(unlist(serra.do.mar_plant_survivors_bodymass)))/((ncol(mat.serra.do.mar))*(nrow(mat.serra.do.mar)))

# get output ready to join with others for graphing

serra.do.mar_plant_survivors_bodymass <- as.data.frame(unlist(serra.do.mar_plant_survivors_bodymass))

# make a frugivores removed column

serra.do.mar_plant_survivors_bodymass$n_frugs_removed <- seq(from = 0, to = 173)

# rename survivor column

names(serra.do.mar_plant_survivors_bodymass)[1]<-"n_plants_remaining"

# add removal scenario column
serra.do.mar_plant_survivors_bodymass$scenario<-"descending_bodymass"

# clean

rm(i, serra.do.mar_new.mat_bodymass, mat.serra.do.mar.temp, serra.do.mar_bodymass_triggerlist)
```

```{r mata caducifolia body-mass-based removal simulation}
 mata.caducifolia_bodymass_triggerlist <- mata.caducifolia_frug_md %>% dplyr::arrange(desc(Frug_Body_Mass)) %>% dplyr::select(Frugivore_Species)
mata.caducifolia_bodymass_triggerlist <- unlist(mata.caducifolia_bodymass_triggerlist)
  #-----------------------------------------#
  mata.caducifolia_new.mat_bodymass<-list()
  mata.caducifolia_new.mat_bodymass[[1]]<-mat.mata.caducifolia
  for(i in 1:length(mata.caducifolia_bodymass_triggerlist)) {
    mat.mata.caducifolia.temp <- mata.caducifolia_new.mat_bodymass[[i]]
    mat.mata.caducifolia.temp[ ,which(colnames(mat.mata.caducifolia.temp) == mata.caducifolia_bodymass_triggerlist[i])]<-0
    mata.caducifolia_new.mat_bodymass[[i+1]] <- mat.mata.caducifolia.temp
  }
  mata.caducifolia_plant_survivors_bodymass <-NULL
  mata.caducifolia_plant_survivors_bodymass[[1]] <- nrow(mat.mata.caducifolia)
  for(i in 1:length(mata.caducifolia_new.mat_bodymass)) {mata.caducifolia_plant_survivors_bodymass[i] <- length(which(rowSums(mata.caducifolia_new.mat_bodymass[[i]])>0))} 
  
mata.caducifolia_robustness_bodymass <-(sum(unlist(mata.caducifolia_plant_survivors_bodymass)))/((ncol(mat.mata.caducifolia))*(nrow(mat.mata.caducifolia)))

# get output ready to join with others for graphing

mata.caducifolia_plant_survivors_bodymass <- as.data.frame(unlist(mata.caducifolia_plant_survivors_bodymass))

# make a frugivores removed column

mata.caducifolia_plant_survivors_bodymass$n_frugs_removed <- seq(from = 0, to = 84)

# rename survivor column

names(mata.caducifolia_plant_survivors_bodymass)[1]<-"n_plants_remaining"

# add removal scenario column
mata.caducifolia_plant_survivors_bodymass$scenario<-"descending_bodymass"

# clean

rm(i, mata.caducifolia_new.mat_bodymass, mat.mata.caducifolia.temp, mata.caducifolia_bodymass_triggerlist)
```

### Removal based on greatest to lowest degree

#### Biome-scale degree-based removal simulations

```{r biome-scale removal scenario of frugivores by descending degree}
    biome_degree_triggerlist <- biome_frug_md %>% dplyr::arrange(desc(Frugivore_degree)) %>% dplyr::select(Frugivore_Species)
biome_degree_triggerlist <- unlist(biome_degree_triggerlist)
  #-----------------------------------------#
  biome_new.mat_degree<-list()
  biome_new.mat_degree[[1]]<-biome.mat
  for(i in 1:length(biome_degree_triggerlist)) {
    biome.mat.temp <- biome_new.mat_degree[[i]]
    biome.mat.temp[ ,which(colnames(biome.mat.temp) == biome_degree_triggerlist[i])]<-0
    biome_new.mat_degree[[i+1]] <- biome.mat.temp
  }
  biome_plant_survivors_degree <-NULL
  biome_plant_survivors_degree[[1]] <- nrow(biome.mat)
  for(i in 1:length(biome_new.mat_degree)) {biome_plant_survivors_degree[i] <- length(which(rowSums(biome_new.mat_degree[[i]])>0))} 
  
biome_robustness_degree <-(sum(unlist(biome_plant_survivors_degree)))/((ncol(biome.mat))*(nrow(biome.mat)))

# get output ready to join with others for graphing

biome_plant_survivors_degree <- as.data.frame(unlist(biome_plant_survivors_degree))

# make a frugivores removed column

biome_plant_survivors_degree$n_frugs_removed <- seq(from = 0, to = 321)

# rename survivor column

names(biome_plant_survivors_degree)[1]<-"n_plants_remaining"

# add removal scenario column
biome_plant_survivors_degree$scenario<-"descending_degree"

# clean

rm(i, biome_new.mat_degree, biome.mat.temp, biome_degree_triggerlist)
```

#### Ecoregion-scale degree-based removal simulations

```{r araucaria degree-based removal simulation}
    araucaria_degree_triggerlist <- araucaria_frug_md %>% dplyr::arrange(desc(Frugivore_degree)) %>% dplyr::select(Frugivore_Species)
araucaria_degree_triggerlist <- unlist(araucaria_degree_triggerlist)
  #-----------------------------------------#
  araucaria_new.mat_degree<-list()
  araucaria_new.mat_degree[[1]]<-mat.araucaria
  for(i in 1:length(araucaria_degree_triggerlist)) {
    mat.araucaria.temp <- araucaria_new.mat_degree[[i]]
    mat.araucaria.temp[ ,which(colnames(mat.araucaria.temp) == araucaria_degree_triggerlist[i])]<-0
    araucaria_new.mat_degree[[i+1]] <- mat.araucaria.temp
  }
  araucaria_plant_survivors_degree <-NULL
  araucaria_plant_survivors_degree[[1]] <- nrow(mat.araucaria)
  for(i in 1:length(araucaria_new.mat_degree)) {araucaria_plant_survivors_degree[i] <- length(which(rowSums(araucaria_new.mat_degree[[i]])>0))} 
  
araucaria_robustness_degree <-(sum(unlist(araucaria_plant_survivors_degree)))/((ncol(mat.araucaria))*(nrow(mat.araucaria)))

# get output ready to join with others for graphing

araucaria_plant_survivors_degree <- as.data.frame(unlist(araucaria_plant_survivors_degree))

# make a frugivores removed column

araucaria_plant_survivors_degree$n_frugs_removed <- seq(from = 0, to = 131)

# rename survivor column

names(araucaria_plant_survivors_degree)[1]<-"n_plants_remaining"

# add removal scenario column
araucaria_plant_survivors_degree$scenario<-"descending_degree"

# clean

rm(i, araucaria_new.mat_degree, mat.araucaria.temp, araucaria_degree_triggerlist)
```

```{r cerrado degree-based removal simulation}
 cerrado_degree_triggerlist <- cerrado_frug_md %>% dplyr::arrange(desc(Frugivore_degree)) %>% dplyr::select(Frugivore_Species)
cerrado_degree_triggerlist <- unlist(cerrado_degree_triggerlist)
  #-----------------------------------------#
  cerrado_new.mat_degree<-list()
  cerrado_new.mat_degree[[1]]<-mat.cerrado
  for(i in 1:length(cerrado_degree_triggerlist)) {
    mat.cerrado.temp <- cerrado_new.mat_degree[[i]]
    mat.cerrado.temp[ ,which(colnames(mat.cerrado.temp) == cerrado_degree_triggerlist[i])]<-0
    cerrado_new.mat_degree[[i+1]] <- mat.cerrado.temp
  }
  cerrado_plant_survivors_degree <-NULL
  cerrado_plant_survivors_degree[[1]] <- nrow(mat.cerrado)
  for(i in 1:length(cerrado_new.mat_degree)) {cerrado_plant_survivors_degree[i] <- length(which(rowSums(cerrado_new.mat_degree[[i]])>0))} 
  
cerrado_robustness_degree <-(sum(unlist(cerrado_plant_survivors_degree)))/((ncol(mat.cerrado))*(nrow(mat.cerrado)))

# get output ready to join with others for graphing

cerrado_plant_survivors_degree <- as.data.frame(unlist(cerrado_plant_survivors_degree))

# make a frugivores removed column

cerrado_plant_survivors_degree$n_frugs_removed <- seq(from = 0, to = 91)

# rename survivor column

names(cerrado_plant_survivors_degree)[1]<-"n_plants_remaining"

# add removal scenario column
cerrado_plant_survivors_degree$scenario<-"descending_degree"

# clean

rm(i, cerrado_new.mat_degree, mat.cerrado.temp, cerrado_degree_triggerlist)
```

```{r serra do mar degree-based removal simulation}
 serra.do.mar_degree_triggerlist <- serra.do.mar_frug_md %>% dplyr::arrange(desc(Frugivore_degree)) %>% dplyr::select(Frugivore_Species)
serra.do.mar_degree_triggerlist <- unlist(serra.do.mar_degree_triggerlist)
  #-----------------------------------------#
  serra.do.mar_new.mat_degree<-list()
  serra.do.mar_new.mat_degree[[1]]<-mat.serra.do.mar
  for(i in 1:length(serra.do.mar_degree_triggerlist)) {
    mat.serra.do.mar.temp <- serra.do.mar_new.mat_degree[[i]]
    mat.serra.do.mar.temp[ ,which(colnames(mat.serra.do.mar.temp) == serra.do.mar_degree_triggerlist[i])]<-0
    serra.do.mar_new.mat_degree[[i+1]] <- mat.serra.do.mar.temp
  }
  serra.do.mar_plant_survivors_degree <-NULL
  serra.do.mar_plant_survivors_degree[[1]] <- nrow(mat.serra.do.mar)
  for(i in 1:length(serra.do.mar_new.mat_degree)) {serra.do.mar_plant_survivors_degree[i] <- length(which(rowSums(serra.do.mar_new.mat_degree[[i]])>0))} 
  
serra.do.mar_robustness_degree <-(sum(unlist(serra.do.mar_plant_survivors_degree)))/((ncol(mat.serra.do.mar))*(nrow(mat.serra.do.mar)))

# get output ready to join with others for graphing

serra.do.mar_plant_survivors_degree <- as.data.frame(unlist(serra.do.mar_plant_survivors_degree))

# make a frugivores removed column

serra.do.mar_plant_survivors_degree$n_frugs_removed <- seq(from = 0, to = 173)

# rename survivor column

names(serra.do.mar_plant_survivors_degree)[1]<-"n_plants_remaining"

# add removal scenario column
serra.do.mar_plant_survivors_degree$scenario<-"descending_degree"

# clean

rm(i, serra.do.mar_new.mat_degree, mat.serra.do.mar.temp, serra.do.mar_degree_triggerlist)
```

```{r mata caducifolia degree-based removal simulation}
 mata.caducifolia_degree_triggerlist <- mata.caducifolia_frug_md %>% dplyr::arrange(desc(Frugivore_degree)) %>% dplyr::select(Frugivore_Species)
mata.caducifolia_degree_triggerlist <- unlist(mata.caducifolia_degree_triggerlist)
  #-----------------------------------------#
  mata.caducifolia_new.mat_degree<-list()
  mata.caducifolia_new.mat_degree[[1]]<-mat.mata.caducifolia
  for(i in 1:length(mata.caducifolia_degree_triggerlist)) {
    mat.mata.caducifolia.temp <- mata.caducifolia_new.mat_degree[[i]]
    mat.mata.caducifolia.temp[ ,which(colnames(mat.mata.caducifolia.temp) == mata.caducifolia_degree_triggerlist[i])]<-0
    mata.caducifolia_new.mat_degree[[i+1]] <- mat.mata.caducifolia.temp
  }
  mata.caducifolia_plant_survivors_degree <-NULL
  mata.caducifolia_plant_survivors_degree[[1]] <- nrow(mat.mata.caducifolia)
  for(i in 1:length(mata.caducifolia_new.mat_degree)) {mata.caducifolia_plant_survivors_degree[i] <- length(which(rowSums(mata.caducifolia_new.mat_degree[[i]])>0))} 
  
mata.caducifolia_robustness_degree <-(sum(unlist(mata.caducifolia_plant_survivors_degree)))/((ncol(mat.mata.caducifolia))*(nrow(mat.mata.caducifolia)))

# get output ready to join with others for graphing

mata.caducifolia_plant_survivors_degree <- as.data.frame(unlist(mata.caducifolia_plant_survivors_degree))

# make a frugivores removed column

mata.caducifolia_plant_survivors_degree$n_frugs_removed <- seq(from = 0, to = 84)

# rename survivor column

names(mata.caducifolia_plant_survivors_degree)[1]<-"n_plants_remaining"

# add removal scenario column
mata.caducifolia_plant_survivors_degree$scenario<-"descending_degree"

# clean

rm(i, mata.caducifolia_new.mat_degree, mat.mata.caducifolia.temp, mata.caducifolia_degree_triggerlist)
```

### Figures, Analysis 3

Each network (biome, plus each ecoregion) has a full version and a zoomed in version of a figure showing the plant coextinctions following the different removal scenarios. The zoomed in versions are enlargements of the graph portions that only show up until the last high risk frugivore (greater than 'least concern' category) is removed from the network.

#### Join data from above scenarios

```{r merge datasets for graphing starting with biome data}

# BIOME:

# biome-scale I need to join biome_plant_survivors_random_btstrped, biome_plant_survivors_IUCN_btstrped, biome_plant_survivors_bodymass, biome_plant_survivors_degree

# different column names exist and need to be unified: random and IUCN data has upper and lower CI data, while the degree and body mass scenarios do not. Just duplicate the plant survivor columns in those two dataframes into 'CI' columns so that the dataframe column names and numbers match up and are mergeable. 

# for my random and iucn scenarios add scenario column, rename 'mean' to 'n_plants_remaining'
biome_plant_survivors_random_btstrped$scenario <- "random"
names(biome_plant_survivors_random_btstrped)[1] <- "n_plants_remaining"
biome_plant_survivors_IUCN_btstrped$scenario <- "descending_endangerment"
names(biome_plant_survivors_IUCN_btstrped)[1] <- "n_plants_remaining"

# for my bodymass and degree based removal data, add the filler CI interval columns that are just duplicates of the raw values bc these are not scenarios that can vary in outcome
biome_plant_survivors_bodymass$upper_95.ci<-biome_plant_survivors_bodymass$n_plants_remaining
biome_plant_survivors_bodymass$lower_95.ci<-biome_plant_survivors_bodymass$n_plants_remaining
biome_plant_survivors_degree$upper_95.ci<-biome_plant_survivors_degree$n_plants_remaining
biome_plant_survivors_degree$lower_95.ci<-biome_plant_survivors_degree$n_plants_remaining

# join

biome_plant_survivors <- rbind(biome_plant_survivors_random_btstrped, biome_plant_survivors_IUCN_btstrped, biome_plant_survivors_bodymass, biome_plant_survivors_degree)

# clean

rm(biome_plant_survivors_bodymass, biome_plant_survivors_degree, biome_plant_survivors_IUCN_btstrped, biome_plant_survivors_random_btstrped)
```

```{r rbind the ecoregion coexinction data for graphing}

# same process as above, but also add ecoregion column to all

# araucaria

araucaria_plant_survivors_random_btstrped$scenario <- "random"
araucaria_plant_survivors_random_btstrped$ecoregion <- "araucaria"
names(araucaria_plant_survivors_random_btstrped)[1] <- "n_plants_remaining"
araucaria_plant_survivors_IUCN_btstrped$scenario <- "descending_endangerment"
araucaria_plant_survivors_IUCN_btstrped$ecoregion <- "araucaria"
names(araucaria_plant_survivors_IUCN_btstrped)[1] <- "n_plants_remaining"

araucaria_plant_survivors_bodymass$upper_95.ci<-araucaria_plant_survivors_bodymass$n_plants_remaining
araucaria_plant_survivors_bodymass$lower_95.ci<-araucaria_plant_survivors_bodymass$n_plants_remaining
araucaria_plant_survivors_degree$upper_95.ci<-araucaria_plant_survivors_degree$n_plants_remaining
araucaria_plant_survivors_degree$lower_95.ci<-araucaria_plant_survivors_degree$n_plants_remaining

araucaria_plant_survivors_bodymass$ecoregion<-"araucaria"
araucaria_plant_survivors_degree$ecoregion<-"araucaria"

# join

araucaria_plant_survivors <- rbind(araucaria_plant_survivors_random_btstrped, araucaria_plant_survivors_IUCN_btstrped, araucaria_plant_survivors_bodymass, araucaria_plant_survivors_degree)

# cerrado

cerrado_plant_survivors_random_btstrped$scenario <- "random"
cerrado_plant_survivors_random_btstrped$ecoregion <- "cerrado"
names(cerrado_plant_survivors_random_btstrped)[1] <- "n_plants_remaining"
cerrado_plant_survivors_IUCN_btstrped$scenario <- "descending_endangerment"
cerrado_plant_survivors_IUCN_btstrped$ecoregion <- "cerrado"
names(cerrado_plant_survivors_IUCN_btstrped)[1] <- "n_plants_remaining"

cerrado_plant_survivors_bodymass$upper_95.ci<-cerrado_plant_survivors_bodymass$n_plants_remaining
cerrado_plant_survivors_bodymass$lower_95.ci<-cerrado_plant_survivors_bodymass$n_plants_remaining
cerrado_plant_survivors_degree$upper_95.ci<-cerrado_plant_survivors_degree$n_plants_remaining
cerrado_plant_survivors_degree$lower_95.ci<-cerrado_plant_survivors_degree$n_plants_remaining

cerrado_plant_survivors_bodymass$ecoregion<-"cerrado"
cerrado_plant_survivors_degree$ecoregion<-"cerrado"

# join

cerrado_plant_survivors <- rbind(cerrado_plant_survivors_random_btstrped, cerrado_plant_survivors_IUCN_btstrped, cerrado_plant_survivors_bodymass, cerrado_plant_survivors_degree)

#serra do mar

serra.do.mar_plant_survivors_random_btstrped$scenario <- "random"
serra.do.mar_plant_survivors_random_btstrped$ecoregion <- "serra.do.mar"
names(serra.do.mar_plant_survivors_random_btstrped)[1] <- "n_plants_remaining"
serra.do.mar_plant_survivors_IUCN_btstrped$scenario <- "descending_endangerment"
serra.do.mar_plant_survivors_IUCN_btstrped$ecoregion <- "serra.do.mar"
names(serra.do.mar_plant_survivors_IUCN_btstrped)[1] <- "n_plants_remaining"

serra.do.mar_plant_survivors_bodymass$upper_95.ci<-serra.do.mar_plant_survivors_bodymass$n_plants_remaining
serra.do.mar_plant_survivors_bodymass$lower_95.ci<-serra.do.mar_plant_survivors_bodymass$n_plants_remaining
serra.do.mar_plant_survivors_degree$upper_95.ci<-serra.do.mar_plant_survivors_degree$n_plants_remaining
serra.do.mar_plant_survivors_degree$lower_95.ci<-serra.do.mar_plant_survivors_degree$n_plants_remaining

serra.do.mar_plant_survivors_bodymass$ecoregion<-"serra.do.mar"
serra.do.mar_plant_survivors_degree$ecoregion<-"serra.do.mar"

# join

serra.do.mar_plant_survivors <- rbind(serra.do.mar_plant_survivors_random_btstrped, serra.do.mar_plant_survivors_IUCN_btstrped, serra.do.mar_plant_survivors_bodymass, serra.do.mar_plant_survivors_degree)

# mata caducifolia

mata.caducifolia_plant_survivors_random_btstrped$scenario <- "random"
mata.caducifolia_plant_survivors_random_btstrped$ecoregion <- "mata.caducifolia"
names(mata.caducifolia_plant_survivors_random_btstrped)[1] <- "n_plants_remaining"
mata.caducifolia_plant_survivors_IUCN_btstrped$scenario <- "descending_endangerment"
mata.caducifolia_plant_survivors_IUCN_btstrped$ecoregion <- "mata.caducifolia"
names(mata.caducifolia_plant_survivors_IUCN_btstrped)[1] <- "n_plants_remaining"

mata.caducifolia_plant_survivors_bodymass$upper_95.ci<-mata.caducifolia_plant_survivors_bodymass$n_plants_remaining
mata.caducifolia_plant_survivors_bodymass$lower_95.ci<-mata.caducifolia_plant_survivors_bodymass$n_plants_remaining
mata.caducifolia_plant_survivors_degree$upper_95.ci<-mata.caducifolia_plant_survivors_degree$n_plants_remaining
mata.caducifolia_plant_survivors_degree$lower_95.ci<-mata.caducifolia_plant_survivors_degree$n_plants_remaining

mata.caducifolia_plant_survivors_bodymass$ecoregion<-"mata.caducifolia"
mata.caducifolia_plant_survivors_degree$ecoregion<-"mata.caducifolia"

# join

mata.caducifolia_plant_survivors <- rbind(mata.caducifolia_plant_survivors_random_btstrped, mata.caducifolia_plant_survivors_IUCN_btstrped, mata.caducifolia_plant_survivors_bodymass, mata.caducifolia_plant_survivors_degree)

# join them all

ecoregion_coextinctions <- rbind(araucaria_plant_survivors, cerrado_plant_survivors, serra.do.mar_plant_survivors, mata.caducifolia_plant_survivors)

rm(araucaria_plant_survivors_random_btstrped, araucaria_plant_survivors_IUCN_btstrped, araucaria_plant_survivors_bodymass, araucaria_plant_survivors_degree, araucaria_plant_survivors, cerrado_plant_survivors_random_btstrped, cerrado_plant_survivors_IUCN_btstrped, cerrado_plant_survivors_bodymass, cerrado_plant_survivors_degree, cerrado_plant_survivors, serra.do.mar_plant_survivors_random_btstrped, serra.do.mar_plant_survivors_IUCN_btstrped, serra.do.mar_plant_survivors_bodymass, serra.do.mar_plant_survivors_degree, serra.do.mar_plant_survivors,mata.caducifolia_plant_survivors_random_btstrped, mata.caducifolia_plant_survivors_IUCN_btstrped, mata.caducifolia_plant_survivors_bodymass, mata.caducifolia_plant_survivors_degree, mata.caducifolia_plant_survivors) 
```

#### Biome coextinction figure

Biome-scale coextinction figure, showing (a) the full network for each removal scenario until all frugivores have been removed and (b) an enlargement of the rectangle in (a) showing the network up until all frugivores at high risk of extinction are removed, illustrating approximately a quarter of the network's tree species would be left without dispersers. 
```{r biome full coextinction plot}
biome_p2 <- biome_plant_survivors %>%
  mutate(scenario = factor(scenario, levels = c("descending_degree", "descending_bodymass", "descending_endangerment", "random" ))) %>%
  ggplot(aes(x = n_frugs_removed, y = n_plants_remaining, group = scenario, color = scenario, linetype = scenario)) + 
  geom_line(size=0.9) +  scale_linetype_manual(values=c(3,2,1,4), labels = c("Most-to-least connected", "Descending body mass", "Descending risk of extinction", "Random")) + 
  theme_bw() + theme(panel.grid.minor = element_blank()) + labs(y="Plants without extant dispersers", x = "# frugivore species lost") + 
  theme(axis.text = element_text(size = 11, color = "black")) +
  theme(axis.title = element_text(size = 11)) + 
  scale_color_manual(values = c("chocolate3", "cyan4", "darkred", "gray"), labels = c("Most-to-least connected", "Descending body mass", "Descending risk of extinction", "Random")) + theme(legend.title = element_blank()) + theme(legend.position = "none") + labs(tag = "(a)") 

# annotate zoom with endangerment labels

biome_p2_zoom <- biome_p2 + ylim(550,786) + xlim(0, 50) + labs(tag = "(b)") + annotate(geom = "segment", x = 5, y = 778, xend = 5, yend = 734, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 5, y =786, label = "CR", fontface = "bold") + 
  annotate(geom = "segment", x = 15, y = 778, xend = 15, yend = 630, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 15, y =786, label = "EN", fontface = "bold") + 
  annotate(geom = "segment", x = 25, y = 778, xend = 25, yend = 599, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 25, y =786, label = "VU", fontface = "bold") + 
  annotate(geom = "segment", x = 44, y = 778, xend = 44, yend = 575, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 44, y =786, label = "NT", fontface = "bold")

# add rectangle of area to zoom in on (if added first, it shows up in the zoom version too)

biome_p3 <- biome_p2 + theme(legend.position="none")+ geom_rect(mapping = aes (xmin = 0, xmax=50, ymin = 550, ymax=778), alpha = 0, color = "black", linetype = 1)

# actually, make it so that the zoomed version is a proportion of the network

biome_plant_survivors$proportion_plants_remaining <- biome_plant_survivors$n_plants_remaining/777

biome_plant_survivors$proportion_frugivores_removed <- biome_plant_survivors$n_frugs_removed/321

# full plot to get zoom from:

biome_proportions_full <- biome_plant_survivors %>%
  mutate(scenario = factor(scenario, levels = c("descending_degree", "descending_bodymass", "descending_endangerment", "random" ))) %>%
  ggplot(aes(x = proportion_frugivores_removed, y = proportion_plants_remaining, group = scenario, color = scenario, linetype = scenario)) + 
  geom_line(size=0.9) +  scale_linetype_manual(values=c(3,2,1,4), labels = c("Most-to-least connected", "Descending body mass", "Descending risk of extinction", "Random")) + 
  theme_bw() + theme(panel.grid.minor = element_blank()) + labs(y="Proportion of plants without extant dispersers", x = "Proportion frugivore species lost") + 
  theme(axis.text = element_text(size = 11, color = "black")) +
  theme(axis.title = element_text(size = 11)) + 
  scale_color_manual(values = c("chocolate3", "cyan4", "darkred", "gray"), labels = c("Most-to-least connected", "Descending body mass", "Descending risk of extinction", "Random")) + theme(legend.title = element_blank()) + theme(legend.position = "none") + labs(tag = "(a)") 

# zoom with proportions for axis

biome_proportion_zoom <- biome_proportions_full + ylim(550/777,786/777) + xlim(0, 50/321) + labs(tag = "(b)") + annotate(geom = "segment", alpha = 0.75, x = 5/321, y = 778/777, xend = 5/321, yend = 734/777, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 5/321, y =786/777, label = "CR") + 
  annotate(geom = "segment",  alpha = 0.75,x = 15/321, y = 778/777, xend = 15/321, yend = 630/777, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 15/321, y =786/777, label = "EN") + 
  annotate(geom = "segment", alpha = 0.75, x = 25/321, y = 778/777, xend = 25/321, yend = 599/777, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 25/321, y =786/777, label = "VU") + 
  annotate(geom = "segment", alpha = 0.75, x = 44/321, y = 778/777, xend = 44/321, yend = 575/777, arrow = arrow(length = unit(2, "mm"), type = "closed")) + annotate(geom = "text", x = 44/321, y =786/777, label = "NT")

save <- ggarrange(biome_p3, biome_proportion_zoom, common.legend = TRUE)
save

# save it

# ggsave(save, file = "Biome_coextinction_panel.pdf", units = "in", width = 6.75, height = 4, dpi = 400)

# clean
rm(save, biome_p2, biome_p3, biome_proportion_zoom, biome_proportions_full, biome_p2_zoom)

```

#### Ecoregion coextinction figures

The same idea as above, but per ecoregion. Not that in the below code chunk, the code used to create plots for the first ecoregion is annotated with comments to explain the process. After the first ecoregion, the code process is the same for the subsequent regions and annotation is not included for them to reduce text/clutter since the comments would all be identical to the codes sections plotting the first ecoregion. 

```{r ecoregion coextinction graphs}

# Cerrado full plot, raw values (not proportions, which are also plotted below)

cerrado_plot1 <- ecoregion_coextinctions %>%
  mutate(scenario = factor(scenario, levels = c("descending_degree",
                                                "descending_bodymass",
                                                "descending_endangerment", 
                                                "random" ))) %>% # put removal type in descending order of anticipated worst-case scenarios
  
  filter(ecoregion == "cerrado") %>% # isolate cerrado ecoregion
  
  ggplot(aes(x = n_frugs_removed, y = n_plants_remaining, 
             group = scenario, color = scenario, linetype = scenario)) +
  geom_line(size=0.9) + # this line size seems best - any larger is chunky looking
  scale_linetype_manual(values=c(3,2,1,4), # specify lines so EN one is solid
                        labels = c("Most-to-least connected", "Descending body mass",
                                   "Descending risk of extinction", "Random")) +
  
    theme_bw() + theme(panel.grid.minor = element_blank()) + # specify a simple theme
  
  labs(y="Plants without extant dispersers", x = "# frugivore species lost") + #name axes
  
  theme(axis.text = element_text(size = 11, color = "black")) +
  theme(axis.title = element_text(size = 11)) + # enlarge axis numbers and text
  
  scale_color_manual(values = c("chocolate3", "cyan4", "darkred", "gray"), labels = c("Most-to-least connected", "Descending body mass", "Descending risk of extinction", "Random")) + # manually add colors I want - try to make it color blind friendly and allow endangerment status line to stand out
  
  theme(legend.position = "none") + # remove legend (add w/'ggarrange' in panel later)
  
  labs(tag = "(a)") #in prep for panel figures, add tage (will label each ecoregion with tag "(a)" through "(f)")


cerrado_plot1 # how does it look?

# -- # 
# Next step: make enlarged section of above plot
# -- #

# Now create enlargement of portion of above plot up to point at which all endangered frugivores have been removed
# Annotate the zoomed in version with endangerment labels

# cerrado_plot1_zoom <- cerrado_plot1 + 

#  ylim(35,57) + # y max overshoots the number of plants in the network so I can fit label on top of arrow below

#  xlim(0, 5) + # ends a few points after all at-risk frugivores have been removed to allow for better visual context of overall network in the enlarged plot

#  labs(tag = "(b)") + # tag for panel, will go next to full cerrado plot ('a')

#  annotate(geom = "segment", x = 3, y = 56, xend = 3, yend = 38, 
#           arrow = arrow(length = unit(2, "mm"), type = "closed")) + # 'segment' becomes the arrow pointing to the spot on the endangerment removal scenario line beyond which all frugivores at greater risk than 'least concern' are removed. The values input here are deduced by looking at the plot and looking at the supplementary data to see how many at-risk frugivores exist in this ecoregion's network (that is the x value) and how many plants are left at that point (that is the 'yend' value)

#  annotate(geom = "text", x = 3, y =57, label = "All CR/EN/VU/NT species lost") # label the arrow - decide on the y value based on what looks good and doesn't interfere with visibility of other lines in the plot

# The above plot is commented out because I prefer the version created below that uses proportions as the axes to illustrate overall network impact more clearly

# -- # next step: add rectanlge over area that gets enlarged

# Add a rectangle drawn over the area to be enlarged in the zoom plot version. This has to be done as a separate plot because if the rectangle is added first and then I use that to make the zoomed in version, the rectangle then also shows up in the enlargement and looks bad 

cerrado_plot2 <- cerrado_plot1 + 
  theme(legend.position="none") + # no legend needed yet
  geom_rect(mapping = aes (xmin = 0, xmax=5, ymin = 36, ymax=56), 
            alpha = 0, color = "black", linetype = 1) # specify borders, color, and fill (transparent, alpha = 0), and linetype of rectangle

cerrado_plot2 # how does it look?

# Use 'cerrado_plot2' when making the panel with all ecoregion figures

# -- #
# Next step: make a plot with proportions instead of raw values
# -- #

# Create plots using PROPORTIONS as axes

cer_prop <- ecoregion_coextinctions %>%
  filter (ecoregion == "cerrado")

cer_prop$proportion_plants_remaining <- cer_prop$n_plants_remaining/nrow(mat.cerrado) # create column with proportion values (total plants in cerrado network = nrows of interaction matrix, so just divide by that)

cer_prop$proportion_frugs_removed <- cer_prop$n_frugs_removed/ncol(mat.cerrado) # repeat this process for frugivore proportions

# Create the full plot version with proportions for axes to get the zoom plot from

cerrado_proportions_full_plot <- cer_prop %>%
  
  mutate(scenario = factor(scenario, levels = c("descending_degree",
                                                "descending_bodymass",
                                                "descending_endangerment", 
                                                "random" ))) %>% # order the scenarios
  
  ggplot(aes(x = proportion_frugs_removed, y = proportion_plants_remaining, 
             group = scenario, color = scenario, linetype = scenario)) + 
  geom_line(size=0.9) + # specify line size
  scale_linetype_manual(values=c(3,2,1,4), labels = c("Most-to-least connected", 
                                                      "Descending body mass",
                                                      "Descending risk of extinction",
                                                      "Random")) + # specify line types
  
  theme_bw() + theme(panel.grid.minor = element_blank()) + # make theme match above
  
  labs(y="Proportion of plants without extant dispersers", 
       x = "Proportion frugivore species lost") + # be sure to adjust labels as props
  
  theme(axis.text = element_text(size = 11, color = "black")) +
  theme(axis.title = element_text(size = 11)) + # keep text the same size on axes
  
  scale_color_manual(values = c("chocolate3", "cyan4", "darkred", "gray"),
                     labels = c("Most-to-least connected", 
                                "Descending body mass",
                                "Descending risk of extinction", 
                                "Random")) + #specify colors
  
  theme(legend.position = "none") + # no legend (add later to panel)
  labs(title="Cerrado") # add plot title 

cerrado_proportions_full_plot # how does it look?

# -- #
# Next step: make englargement version but w/proportions for axes
# -- #

# Now make the zoom plot with proportions for axes

cerrado_proportion_zoom <- cerrado_proportions_full_plot + 
ylim(35/nrow(mat.cerrado), 57/nrow(mat.cerrado)) + 
  xlim(0, 5/ncol(mat.cerrado)) +#specify region of plot above I want a zoom of, adjust the original version of zoomed plot above to make values proportions
  
 labs(tag = "(b)") + # tag b
  
 annotate(geom = "segment", x = 3/ncol(mat.cerrado), 
          y = 56/nrow(mat.cerrado), 
          xend = 3/ncol(mat.cerrado), 
          yend = 38/nrow(mat.cerrado), 
         arrow = arrow(length = unit(2, "mm"), type = "closed")) + # where arrow should go to point to spot on endangerment removal scenario line beyond which all frugivores greater than least concern by IUCN status are gone  
  
annotate(geom = "text", x = 3/ncol(mat.cerrado), 
         y =57/nrow(mat.cerrado), label = "All CR/EN/VU/NT species lost") # label the arrow

cerrado_proportion_zoom # how does it look?

# Ultimately, I think I like the proportion versions for both the full view and the zoom view plots

# END CERRADO

# -- #
# NEXT ECOREGION
# -- #

# Serra do Mar

# Make columns with proportion values to use

serra_prop <- ecoregion_coextinctions %>%
  filter (ecoregion == "serra.do.mar")

serra_prop$proportion_plants_remaining <- serra_prop$n_plants_remaining/nrow(mat.serra.do.mar) 

serra_prop$proportion_frugs_removed <- serra_prop$n_frugs_removed/ncol(mat.serra.do.mar)

# Create the full plot version with proportions for axes to get the zoom plot from

serra.do.mar_proportions_full_plot <- serra_prop %>%
  
  mutate(scenario = factor(scenario, 
                           levels = c("descending_degree",
                                                "descending_bodymass",
                                                "descending_endangerment", 
                                                "random" ))) %>%
  
  ggplot(aes(x = proportion_frugs_removed, 
             y = proportion_plants_remaining, 
             group = scenario, 
             color = scenario, 
             linetype = scenario)) + 
  geom_line(size=0.9) +
  scale_linetype_manual(values=c(3,2,1,4),
                        labels = c("Most-to-least connected", 
                                                      "Descending body mass",
                                                      "Descending risk of extinction",
                                                      "Random")) +
  theme_bw() + theme(panel.grid.minor = element_blank()) +
  labs(y="Proportion of plants without extant dispersers", 
       x = "Proportion frugivore species lost") +  
  theme(axis.text = element_text(size = 11, color = "black")) +
  theme(axis.title = element_text(size = 11)) + 
  scale_color_manual(values = c("chocolate3", "cyan4", "darkred", "gray"),
                     labels = c("Most-to-least connected", "Descending body mass",
                                "Descending risk of extinction", "Random")) + 
  theme(legend.position = "none") +
  labs(title="Serra do Mar")

serra.do.mar_proportions_full_plot # how does it look?

# -- # 
# Next step: add rectangle over area that gets enlarged
# -- #

serra.do.mar_proportions_full_plot_rectangle <- serra.do.mar_proportions_full_plot + 
  theme(legend.position="none") +
  geom_rect(mapping = aes (xmin = 0, xmax= 15/ncol(mat.serra.do.mar), ymin = 170/nrow(mat.serra.do.mar), ymax=246/nrow(mat.serra.do.mar)), 
            alpha = 0, color = "black", linetype = 1) + labs(tag="c")

serra.do.mar_proportions_full_plot_rectangle # how does it look?


# -- #
# Next step: enlarge it and annotate it
# -- #

serra.do.mar_proportion_zoom <- serra.do.mar_proportions_full_plot + 
ylim(120/nrow(mat.serra.do.mar), 1.05) + xlim(0, 18/ncol(mat.serra.do.mar)) +
 labs(tag = "(d)") +
 annotate(geom = "segment", x = 13/ncol(mat.serra.do.mar), y = 246/nrow(mat.serra.do.mar), 
          xend = 13/ncol(mat.serra.do.mar), yend = 171/nrow(mat.serra.do.mar), 
         arrow = arrow(length = unit(2, "mm"), type = "closed")) +  
annotate(geom = "text", x = 13/ncol(mat.serra.do.mar), y =1.05, label = "All CR/EN/VU/NT species lost")

serra.do.mar_proportion_zoom # how does it look?




#save <- ggarrange(biome_p3, biome_proportion_zoom, common.legend = TRUE)
#save


```

```

# Session Info

This is key (though minimally) for reproducibility---replicate the code chunk below exactly

```{r Session Info}
sessionInfo()
```

